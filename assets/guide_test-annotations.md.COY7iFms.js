import{_ as n,o as t,i as e,R as a,j as s,aY as l,aZ as p,a_ as h,a$ as k}from"./chunks/framework.XDTXXE-5.js";const b=JSON.parse('{"title":"Test Annotations | Guide","description":"","frontmatter":{"title":"Test Annotations | Guide","outline":"deep"},"headers":[],"relativePath":"guide/test-annotations.md","filePath":"guide/test-annotations.md","lastUpdated":1771601921000}'),r={name:"guide/test-annotations.md"};function o(d,i,c,g,E,y){return t(),e("div",null,[...i[0]||(i[0]=[a(`<h1 id="test-annotations" tabindex="-1">测试注释 <a class="header-anchor" href="#test-annotations" aria-label="Permalink to “测试注释”">​</a></h1><p>Vitest 支持通过 <a href="/guide/test-context.html#annotate"><code>context.annotate</code></a> API 为测试添加自定义消息和文件注释。这些注释会附加到测试用例上，并通过 <a href="/api/advanced/reporters.html#ontestannotate"><code>onTestAnnotate</code></a> 钩子传递给报告器。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;hello world&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">annotate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> annotate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;this is my test&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (condition) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> annotate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;this should</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\&#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ve errored&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;error&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> file</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createTestSpecificFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> annotate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;creates a file&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { body: file })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p><code>annotate</code> 函数返回一个 Promise，因此如果你依赖它的结果需使用 await。不过，Vitest 也会在测试结束前自动等待任何未被 await 的注释完成。</p></div><p>根据你使用的报告器不同，注释的显示方式也会有所差异。</p><h2 id="built-in-reporters" tabindex="-1">内置报告器 <a class="header-anchor" href="#built-in-reporters" aria-label="Permalink to “内置报告器”">​</a></h2><h3 id="default" tabindex="-1">default <a class="header-anchor" href="#default" aria-label="Permalink to “default”">​</a></h3><p><code>default</code> 报告器仅在测试失败时打印注释：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>  ⎯⎯⎯⎯⎯⎯⎯ Failed Tests 1 ⎯⎯⎯⎯⎯⎯⎯</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  FAIL  example.test.js &gt; an example of a test with annotation</span></span>
<span class="line"><span>Error: thrown error</span></span>
<span class="line"><span>  ❯ example.test.js:11:21</span></span>
<span class="line"><span>      9 |    await annotate(&#39;annotation 1&#39;)</span></span>
<span class="line"><span>      10|    await annotate(&#39;annotation 2&#39;, &#39;warning&#39;)</span></span>
<span class="line"><span>      11|    throw new Error(&#39;thrown error&#39;)</span></span>
<span class="line"><span>        |          ^</span></span>
<span class="line"><span>      12|  })</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ❯ example.test.js:9:15 notice</span></span>
<span class="line"><span>    ↳ annotation 1</span></span>
<span class="line"><span>  ❯ example.test.js:10:15 warning</span></span>
<span class="line"><span>    ↳ annotation 2</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/1]⎯</span></span></code></pre></div><h3 id="verbose" tabindex="-1">verbose <a class="header-anchor" href="#verbose" aria-label="Permalink to “verbose”">​</a></h3><p><code>verbose</code> 报告器是唯一一个在测试通过时也会报告注释的终端报告器。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>✓ example.test.js &gt; an example of a test with annotation</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ❯ example.test.js:9:15 notice</span></span>
<span class="line"><span>    ↳ annotation 1</span></span>
<span class="line"><span>  ❯ example.test.js:10:15 warning</span></span>
<span class="line"><span>    ↳ annotation 2</span></span></code></pre></div><h3 id="html" tabindex="-1">html <a class="header-anchor" href="#html" aria-label="Permalink to “html”">​</a></h3><p>HTML 报告器以与 UI 模式相同的方式显示注释。你可以在调用注释的那一行看到它。目前，如果注释不是在测试文件中调用的，你将无法在界面中看到它。我们计划支持单独的测试摘要视图来展示这些注释。</p>`,14),s("img",{alt:"Vitest UI","img-light":"",src:l},null,-1),s("img",{alt:"Vitest UI","img-dark":"",src:p},null,-1),a(`<h3 id="junit" tabindex="-1">junit <a class="header-anchor" href="#junit" aria-label="Permalink to “junit”">​</a></h3><p><code>junit</code> 报告器将注释列在测试用例的 <code>properties</code> 标签内。JUnit 报告器会忽略所有附件，仅打印注释类型和消息内容。</p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">testcase</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> classname</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;basic/example.test.js&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;an example of a test with annotation&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> time</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.14315&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">property</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;notice&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> value</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;the message of the annotation&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">property</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">properties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">testcase</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div><h3 id="github-actions" tabindex="-1">github-actions <a class="header-anchor" href="#github-actions" aria-label="Permalink to “github-actions”">​</a></h3><p><code>github-actions</code> 报告器默认将注释打印为 <a href="https://docs.github.com/en/actions/writing-workflows/choosing-what-your-workflow-does/workflow-commands-for-github-actions#setting-a-notice-message" target="_blank" rel="noreferrer">notice 消息</a>。你可以通过传递第二个参数来配置 <code>type</code>，可选值为 <code>notice</code>、<code>warning</code> 或 <code>error</code>。如果类型不是这些值之一，Vitest 将以 notice 形式显示消息。</p>`,5),s("img",{alt:"GitHub Actions","img-light":"",src:h},null,-1),s("img",{alt:"GitHub Actions","img-dark":"",src:k},null,-1),a(`<h3 id="tap" tabindex="-1">tap <a class="header-anchor" href="#tap" aria-label="Permalink to “tap”">​</a></h3><p><code>tap</code> 和 <code>tap-flat</code> 报告器将注释打印为新行上以 <code>#</code> 符号开头的诊断消息。它们会忽略所有附件，只打印类型和消息：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>ok 1 - an example of a test with annotation # time=143.15ms</span></span>
<span class="line"><span>    # notice: the message of the annotation</span></span></code></pre></div>`,3)])])}const m=n(r,[["render",o]]);export{b as __pageData,m as default};
