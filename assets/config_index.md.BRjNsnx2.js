import{_ as p}from"./chunks/theme.DgHYi77D.js";import{_ as h}from"./chunks/NonProjectOption.DqDJezAG.js";import{_ as d,b as k,i as c,o as g,ar as l,j as i,M as e,g as a,w as t}from"./chunks/framework.lk4jPI36.js";const js=JSON.parse('{"title":"配置索引","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"config/index.md","filePath":"config/index.md","lastUpdated":1758986088000}'),E={name:"config/index.md"},u={class:"warning custom-block"},y={id:"deps-web-0-34-2",tabindex:"-1"},b={id:"update",tabindex:"-1"},f={id:"watch",tabindex:"-1"},m={id:"watchtriggerpatterns",tabindex:"-1"},F={id:"reporters",tabindex:"-1"},v={id:"outputfile",tabindex:"-1"},C={id:"pool",tabindex:"-1"},A={id:"threads",tabindex:"-1"},x={id:"forks",tabindex:"-1"},T={id:"vmthreads",tabindex:"-1"},D={id:"vmforks",tabindex:"-1"},B={id:"pooloptions",tabindex:"-1"},P={id:"pooloptions-threads-maxthreads",tabindex:"-1"},_={id:"pooloptions-threads-minthreads",tabindex:"-1"},S={id:"pooloptions-threads-useatomics",tabindex:"-1"},I={id:"pooloptions-threads-execargv",tabindex:"-1"},V={id:"pooloptions-forks-maxforks",tabindex:"-1"},j={id:"pooloptions-forks-minforks",tabindex:"-1"},w={id:"pooloptions-forks-execargv",tabindex:"-1"},N={id:"pooloptions-vmthreads-maxthreads",tabindex:"-1"},q={id:"pooloptions-vmthreads-minthreads",tabindex:"-1"},R={id:"pooloptions-vmthreads-memorylimit",tabindex:"-1"},O={id:"pooloptions-vmthreads-useatomics",tabindex:"-1"},M={id:"pooloptions-vmthreads-execargv",tabindex:"-1"},L={id:"pooloptions-vmforks",tabindex:"-1"},W={id:"pooloptions-vmforks-maxforks",tabindex:"-1"},U={id:"pooloptions-vmforks-minforks",tabindex:"-1"},z={id:"pooloptions-vmforks-memorylimit",tabindex:"-1"},G={id:"pooloptions-vmforks-execargv",tabindex:"-1"},J={id:"fileparallelism",tabindex:"-1"},H={id:"maxworkers",tabindex:"-1"},K={id:"minworkers",tabindex:"-1"},$={id:"teardowntimeout",tabindex:"-1"},X={id:"silent",tabindex:"-1"},Y={id:"provide",tabindex:"-1"},Q={class:"warning custom-block"},Z={class:"vp-code-group"},ss={class:"tabs"},is={"data-title":"globalSetup.ts <Version>3.0.0</Version>",for:"tab-1916"},es={"data-title":"globalSetup.ts <Version>2.0.0</Version>",for:"tab-1917"},as={id:"forcereruntriggers",tabindex:"-1"},ns={id:"coverage",tabindex:"-1"},ls={id:"coverage-exclude-after-remap",tabindex:"-1"},ts={id:"coverage-thresholds-glob-pattern-100",tabindex:"-1"},os={id:"testnamepattern",tabindex:"-1"},rs={id:"open",tabindex:"-1"},ps={id:"browser",tabindex:"-1"},hs={id:"snapshotformat",tabindex:"-1"},ds={id:"snapshotserializers",tabindex:"-1"},ks={id:"resolvesnapshotpath",tabindex:"-1"},cs={id:"dangerouslyignoreunhandlederrors",tabindex:"-1"},gs={id:"passwithnotests",tabindex:"-1"},Es={id:"cache",tabindex:"-1"},us={id:"sequence-sequencer",tabindex:"-1"},ys={id:"grouporder",tabindex:"-1"},bs={id:"sequence-seed",tabindex:"-1"},fs={id:"slowtestthreshold",tabindex:"-1"},ms={id:"onconsolelog",tabindex:"-1"},Fs={id:"onstacktrace",tabindex:"-1"},vs={id:"onunhandlederror",tabindex:"-1"},Cs={id:"projects",tabindex:"-1"},As={id:"attachmentsdir-3-2-0",tabindex:"-1"};function xs(Ts,s,Ds,Bs,Ps,_s){const n=h,r=k("Badge"),o=p;return g(),c("div",null,[s[196]||(s[196]=l(`<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /config/index.md for this page in Markdown format</div><h1 id="配置索引" tabindex="-1">配置索引 <a class="header-anchor" href="#配置索引" aria-label="Permalink to “配置索引”">​</a></h1><p>如果我们正在使用 Vite 并且拥有一个 <code>vite.config</code> 文件，Vitest 会读取它来匹配我们的 Vite 应用的插件和设置。如果我们想要为测试配置不同的设置，或者我们的并不特别依赖于 Vite，我们我们可以选择：</p><ul><li>创建 <code>vitest.config.ts</code>，它将具有更高的优先级，并且会<strong>覆盖</strong> <code>vite.config.ts</code> 中的配置（Vitest 支持所有传统的 JS 和 TS 文件扩展名，但不支持 <code>json</code>） - 这意味着我们在 <code>vite.config</code> 中的所有选项将被<strong>忽略</strong>。</li><li>向 CLI 传递 <code>--config</code> 选项，例如 <code>vitest --config ./path/to/vitest.config.ts</code>。</li><li>使用 <code>process.env.VITEST</code> 或在 <code>defineConfig</code> 上的 <code>mode</code> 属性（如果没有用 <code>--mode</code> 覆盖，默认设置为 <code>test</code>/<code>benchmark</code>）来在 <code>vite.config.ts</code> 中有条件地应用不同的配置。</li></ul><p>要配置 Vitest 本身，请在我们的 Vite 配置中添加 <code>test</code> 属性。如果我们是从 <code>vite</code> 本身导入 <code>defineConfig</code>，我们还需要在配置文件顶部使用<a href="https://www.typescriptlang.org/docs/handbook/triple-slash-directives.html#-reference-types-" target="_blank" rel="noreferrer">三斜杠指令</a>添加对 Vitest 类型引用。</p><details class="details custom-block"><summary>Open Config Examples</summary><p>使用 <code>vite</code> 中的 <code>defineConfig</code> 时使用以下步骤：</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="vite.config.js">vite.config.js</span></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">reference</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> types</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vitest&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... Specify options here.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></div><p><code>&lt;reference types=&quot;vitest&quot; /&gt;</code> 将在 Vitest 4 中停止工作，但我们已经可以开始迁移到 <code>vitest/config</code>：</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="vite.config.js">vite.config.js</span></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/// &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">reference</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> types</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vitest/config&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... Specify options here.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></div><p>使用 <code>vitest/config</code> 中的 <code>defineConfig</code> 时应遵循以下步骤：</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="vitest.config.js">vitest.config.js</span></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ... Specify options here.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></div><p>我们可以检索 Vitest 的默认选项，以便在需要时扩展它们：</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="vitest.config.js">vitest.config.js</span></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { configDefaults, defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    exclude: [</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">configDefaults.exclude, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;packages/template/*&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></div><p>当使用单独的 <code>vitest.config.js</code> 时，我们还可以根据需要从另一个配置文件扩展 Vite 的选项：</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="vitest.config.js">vitest.config.js</span></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig, mergeConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> viteConfig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./vite.config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mergeConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(viteConfig, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    exclude: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;packages/template/*&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}))</span></span></code></pre></div></div><p>如果我们的 Vite 配置定义为一个函数，我们可以像这样定义配置：</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="vitest.config.js">vitest.config.js</span></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig, mergeConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> viteConfig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./vite.config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">configEnv</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> mergeConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  viteConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(configEnv),</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      exclude: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;packages/template/*&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span></code></pre></div></div></details>`,6)),i("div",u,[s[4]||(s[4]=l(`<p class="custom-block-title custom-block-title-default">WARNING</p><p>本页上列出的 <em>所有选项</em> 都位于配置内的 <code>test</code> 属性内：</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="vitest.config.js">vitest.config.js</span></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    exclude: [],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></div><p>由于 Vitest 使用 Vite 的配置，我们也可以使用 <a href="https://vitejs.dev/config/" target="_blank" rel="noreferrer">Vite</a> 中的任何配置选项。例如，使用 <code>define</code> 来定义全局变量，或者使用 <code>resolve.alias</code> 来定义别名——这些选项应该在顶级定义，而不是在 <code>test</code> 属性内部。</p>`,4)),i("p",null,[s[0]||(s[0]=e("在 ",-1)),s[1]||(s[1]=i("a",{href:"/guide/projects.html"},"项目",-1)),s[2]||(s[2]=e(" 配置里不被支持的选项，会在旁边标注 ",-1)),a(n),s[3]||(s[3]=e(" 。这表示这些选项只能在 Vitest 的根配置中进行设置。",-1))])]),s[197]||(s[197]=l('<h3 id="include" tabindex="-1">include <a class="header-anchor" href="#include" aria-label="Permalink to “include”">​</a></h3><ul><li><strong>类型:</strong> <code>string[]</code></li><li><strong>默认值:</strong> <code>[&#39;**/*.{test,spec}.?(c|m)[jt]s?(x)&#39;]</code></li></ul><p>匹配包含测试文件的 glob 规则。</p><div class="tip custom-block"><p class="custom-block-title">NOTE</p><p>使用 coverage 时，Vitest 会自动将测试文件的 <code>include</code> 模式添加到 coverage 的默认 <code>exclude</code> 模式中。请参见 <a href="#coverage-exclude"><code>coverage.exclude</code></a>。</p></div><h3 id="exclude" tabindex="-1">exclude <a class="header-anchor" href="#exclude" aria-label="Permalink to “exclude”">​</a></h3><ul><li><strong>类型:</strong> <code>string[]</code></li><li><strong>默认值:</strong> <code>[&#39;**/node_modules/**&#39;, &#39;**/.git/**&#39;]</code></li><li><strong>命令行终端:</strong> <code>vitest --exclude &quot;**/excluded-file&quot; --exclude &quot;*/other-files/*.js&quot;</code></li></ul><p>匹配排除测试文件的 glob 规则。</p><h3 id="includesource" tabindex="-1">includeSource <a class="header-anchor" href="#includesource" aria-label="Permalink to “includeSource”">​</a></h3><ul><li><strong>类型:</strong> <code>string[]</code></li><li><strong>默认值:</strong> <code>[]</code></li></ul><p>包括源代码中的测试文件的通配符。</p><p>当定义时，Vitest 将运行所有包含 <code>import.meta.vitest</code> 的匹配文件。</p><h3 id="name" tabindex="-1">name <a class="header-anchor" href="#name" aria-label="Permalink to “name”">​</a></h3><ul><li><strong>Type:</strong> <code>string | { label: string, color?: LabelColor }</code></li></ul><p>你可以为测试项目或 Vitest 进程指定一个自定义名称，这个名称会在命令行界面（CLI）和用户界面（UI）中显示，同时也能通过 Node.js API 中的 <a href="/advanced/api/test-project.html#name"><code>project.name</code></a> 获取。</p><p>此外，如果你提供一个包含 color 属性的对象，还可以自定义 CLI 和 UI 中显示名称的颜色。</p><h3 id="server" tabindex="-1">server <a class="header-anchor" href="#server" aria-label="Permalink to “server”">​</a></h3><ul><li><strong>类型:</strong> <code>{ sourcemap?, deps?, ... }</code></li><li><strong>版本:</strong> Since Vitest 0.34.0</li></ul><p>Vite-Node 服务端选项。</p><h4 id="server-sourcemap" tabindex="-1">server.sourcemap <a class="header-anchor" href="#server-sourcemap" aria-label="Permalink to “server.sourcemap”">​</a></h4><ul><li><strong>类型:</strong> <code>&#39;inline&#39; | boolean</code></li><li><strong>默认值:</strong> <code>&#39;inline&#39;</code></li></ul><p>通过内联方式注入到模块。</p><h4 id="server-debug" tabindex="-1">server.debug <a class="header-anchor" href="#server-debug" aria-label="Permalink to “server.debug”">​</a></h4><ul><li><strong>类型:</strong> <code>{ dumpModules?, loadDumppedModules? }</code></li></ul><p>Vite-Node 调试器选项。</p><h4 id="server-debug-dumpmodules" tabindex="-1">server.debug.dumpModules <a class="header-anchor" href="#server-debug-dumpmodules" aria-label="Permalink to “server.debug.dumpModules”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean | string</code></li></ul><p>将转换后的模块转储到文件系统。传递字符串将转储到指定路径。</p><h4 id="server-debug-loaddumppedmodules" tabindex="-1">server.debug.loadDumppedModules <a class="header-anchor" href="#server-debug-loaddumppedmodules" aria-label="Permalink to “server.debug.loadDumppedModules”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li></ul><p>不管是否存在，就从文件系统中读取转储的模块。通过修改文件系统的转储结果对于调试会有帮助。</p><h4 id="server-deps" tabindex="-1">server.deps <a class="header-anchor" href="#server-deps" aria-label="Permalink to “server.deps”">​</a></h4><ul><li><strong>类型:</strong> <code>{ external?, inline?, ... }</code></li></ul><p>对依赖关系进行内联或外联的处理</p><h4 id="server-deps-external" tabindex="-1">server.deps.external <a class="header-anchor" href="#server-deps-external" aria-label="Permalink to “server.deps.external”">​</a></h4><ul><li><strong>类型:</strong> <code>(string | RegExp)[]</code></li><li><strong>默认值:</strong> <code>[/\\/node_modules\\//]</code></li></ul><p>外部化（Externalize）意味着 Vite 将绕过原生 Node 的包。外部化依赖不会应用于 Vite 的转换器和解析器，因此它们不支持重新加载时的 HMR。 <code>node_modules</code> 下的所有包都被外部化。</p><p>这些选项支持在 <code>node_modules</code> 中编写的包名称或在 <a href="#deps-moduledirectories"><code>deps.moduleDirectories</code></a> 中指定的包名称。例如，位于 <code>packages/some-name</code> 内的包<code>@company/some-name</code> 应指定为 <code>some-name</code>，并且 <code>packages</code> 应包含在 <code>deps.moduleDirectories</code> 中。基本上，Vitest 总是检查文件路径，而不是实际的包名称。</p><p>如果成功匹配，Vitest 会在 <em>file path</em> 上调用它，而不是包名称。</p><h4 id="server-deps-inline" tabindex="-1">server.deps.inline <a class="header-anchor" href="#server-deps-inline" aria-label="Permalink to “server.deps.inline”">​</a></h4><ul><li><strong>类型:</strong> <code>(string | RegExp)[] | true</code></li><li><strong>默认值:</strong> <code>[]</code></li></ul><p>Vite 将处理内联模块。这可能有助于处理以 ESM 格式传送 <code>.js</code> 的包（Node 无法处理）。</p><p>如果设置为 <code>true</code>，则每个依赖项都将被内联。默认情况下，将内联 <a href="https://cn.vitejs.dev/guide/ssr.html#ssr-externals" target="_blank" rel="noreferrer"><code>ssr.noExternal</code></a> 中指定的所有依赖项。</p><h4 id="server-deps-fallbackcjs" tabindex="-1">server.deps.fallbackCJS <a class="header-anchor" href="#server-deps-fallbackcjs" aria-label="Permalink to “server.deps.fallbackCJS”">​</a></h4><ul><li><strong>类型</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li></ul><p>当依赖项是有效的 ESM 包时，尝试根据路径猜测 cjs 版本。如果依赖项是有错误的 ESM 文件，这可能会有所帮助。</p><p>如果包在 ESM 和 CJS 模式下具有不同的逻辑，这可能会导致一些错位。</p><h4 id="server-deps-cachedir" tabindex="-1">server.deps.cacheDir <a class="header-anchor" href="#server-deps-cachedir" aria-label="Permalink to “server.deps.cacheDir”">​</a></h4><ul><li><strong>类型</strong> <code>string</code></li><li><strong>默认值</strong>: <code>&#39;node_modules/.vite&#39;</code></li></ul><p>保存缓存文件的目录。</p><h3 id="deps" tabindex="-1">deps <a class="header-anchor" href="#deps" aria-label="Permalink to “deps”">​</a></h3><ul><li><strong>类型:</strong> <code>{ optimizer?, ... }</code></li></ul><p>处理依赖关系解析。</p><h4 id="deps-optimizer" tabindex="-1">deps.optimizer <a class="header-anchor" href="#deps-optimizer" aria-label="Permalink to “deps.optimizer”">​</a></h4><ul><li><strong>类型:</strong> <code>{ ssr?, client? }</code></li><li><strong>参考:</strong> <a href="https://vitejs.dev/config/dep-optimization-options.html" target="_blank" rel="noreferrer">Dep Optimization Options</a></li></ul><p>启用依赖优化。如果你有很多测试，这可能会提高它们的性能。</p><p>当 Vitest 遇到 <code>include</code> 中列出的外部库时，它将使用 esbuild 打包到单个文件中，并作为整个模块导入。这很好，原因如下：</p><ul><li>导入大量导入的包很昂贵。通过将它们捆绑到一个文件中，我们可以节省大量时间</li><li>导入 UI 库很昂贵，因为它们并不意味着在 Node.js 中运行</li><li>你的 <code>alias</code> 配置现在在捆绑包中得到处理</li><li>测试中的代码更接近于它在浏览器中的运行方式</li></ul><p>仅当包名出现在 <code>deps.optimizer?.[mode].include</code> 中时，才会被预打包（如 Svelte 等插件会自动填充）。完整选项见 <a href="https://cn.vitejs.dev/config/dep-optimization-options.html" target="_blank" rel="noreferrer">Vite 文档</a>（Vitest 暂不支持 <code>disable</code> 与 <code>noDiscovery</code>）。</p><p>默认策略：</p><ul><li><p><code>jsdom</code> / <code>happy-dom</code> → <code>optimizer.client</code></p></li><li><p><code>node</code> / <code>edge</code> → <code>optimizer.ssr</code></p></li></ul><p>此选项还继承了你的 <code>optimizeDeps</code> 配置（对于 web 环境， Vitest 将会继承 <code>optimizeDeps</code>，对于 ssr 则是 <code>ssr.optimizeDeps</code>）。如果你在 <code>deps.experimentalOptimizer</code> 中重新定义 <code>include</code>/<code>exclude</code>/<code>entries</code> 选项，它将在运行测试时覆盖你的 <code>optimizeDeps</code>。如果它们在 <code>exclude</code> 中配置，Vitest 会自动从 <code>include</code> 中删除相同的选项。</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>你将无法编辑用于调试的 <code>node_modules</code> 代码，因为该代码实际上位于你的 <code>cacheDir</code> 或 <code>test.cache.dir</code> 目录中。如果你想使用 <code>console.log</code> 语句进行调试，请直接编辑它或使用 <code>deps.experimentalOptimizer?.[mode].force</code> 选项强制重新绑定。</p></div><h4 id="deps-optimizer-mode-enabled" tabindex="-1">deps.optimizer.{mode}.enabled <a class="header-anchor" href="#deps-optimizer-mode-enabled" aria-label="Permalink to “deps.optimizer.{mode}.enabled”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li></ul><p>启用依赖优化。</p><h4 id="deps-client" tabindex="-1">deps.client <a class="header-anchor" href="#deps-client" aria-label="Permalink to “deps.client”">​</a></h4>',66)),i("h4",y,[s[6]||(s[6]=e("deps.web ",-1)),a(r,{type:"info"},{default:t(()=>s[5]||(s[5]=[e("0.34.2+",-1)])),_:1,__:[5]}),s[7]||(s[7]=e()),s[8]||(s[8]=i("a",{class:"header-anchor",href:"#deps-web-0-34-2","aria-label":"Permalink to “deps.web 0.34.2+”"},"​",-1))]),s[198]||(s[198]=l(`<p>仅当环境设为 <code>client</code> 时，下列选项才会作用于外部文件。</p><p>默认映射：</p><ul><li><p><code>jsdom</code>、<code>happy-dom</code> → <code>client</code></p></li><li><p><code>node</code>、<code>edge</code> → <code>ssr</code></p></li></ul><p>故这些选项对后者中的文件无效。</p><ul><li><strong>类型:</strong> <code>{ transformAssets?, ... }</code></li></ul><p>当转换模式设置为 <code>web</code> 时应用于外部文件的选项。默认情况下，<code>jsdom</code> 和 <code>happy-dom</code> 使用 <code>web</code> 模式，而 <code>node</code> 和 <code>edge</code> 环境使用 <code>ssr</code> 转换模式，因此这些选项不会影响这些环境中的文件。</p><p>通常，<code>node_modules</code> 内的文件是外部化的，但这些选项也会影响 <a href="#server-deps-external"><code>server.deps.external</code></a> 中的文件。</p><h4 id="deps-client-transformassets" tabindex="-1">deps.client.transformAssets <a class="header-anchor" href="#deps-client-transformassets" aria-label="Permalink to “deps.client.transformAssets”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>true</code></li></ul><p>Vitest 是否应该像 Vite 在浏览器中一样处理静态资源（.png、.svg、.jpg 等）文件并解析它们。</p><p>如果未指定查询，此模块将具有等同于静态资源路径的默认导出。</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>目前，此选项适用于 <a href="#vmthreads"><code>vmThreads</code></a> 和 <a href="#vmforks"><code>vmForks</code></a> 池。</p></div><h4 id="deps-client-transformcss" tabindex="-1">deps.client.transformCss <a class="header-anchor" href="#deps-client-transformcss" aria-label="Permalink to “deps.client.transformCss”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>true</code></li></ul><p>Vitest 是否应该像 Vite 在浏览器中一样处理静态资源（.css, .scss, .sass 等）文件并解析它们。</p><p>如果使用 <a href="#css"><code>css</code></a> 选项禁用 CSS 文件，则此选项只会消除 <code>ERR_UNKNOWN_FILE_EXTENSION</code> 错误。</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>目前，此选项仅适用于 <a href="#vmthreads"><code>vmThreads</code></a> 和 <a href="#vmforks"><code>vmForks</code></a> 池。</p></div><h4 id="deps-client-transformglobpattern" tabindex="-1">deps.client.transformGlobPattern <a class="header-anchor" href="#deps-client-transformglobpattern" aria-label="Permalink to “deps.client.transformGlobPattern”">​</a></h4><ul><li><strong>类型:</strong> <code>RegExp | RegExp[]</code></li><li><strong>默认值:</strong> <code>[]</code></li></ul><p>正则表达式模式匹配应转换的外部文件。</p><p>默认情况下，<code>node_modules</code> 内的文件是外部化的，不会被转换，除非它是 CSS 或静态资源，并且相应的选项不会被禁用。</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>目前，此选项仅适用于 <a href="#vmthreads"><code>vmThreads</code></a> 和 <a href="#vmforks"><code>vmForks</code></a> 池。</p></div><h4 id="deps-interopdefault" tabindex="-1">deps.interopDefault <a class="header-anchor" href="#deps-interopdefault" aria-label="Permalink to “deps.interopDefault”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>true</code></li></ul><p>将 CJS 模块的默认值视为命名导出。某些依赖项仅捆绑 CJS 模块，不使用命名导出，Node.js 可以在使用 <code>import</code> 语法而不是 <code>require</code> 导入包时对其进行静态分析。使用命名导出在 Node 环境中导入此类依赖项时，你将看到此错误：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>import { read } from &#39;fs-jetpack&#39;;</span></span>
<span class="line"><span>         ^^^^</span></span>
<span class="line"><span>SyntaxError: Named export &#39;read&#39; not found. The requested module &#39;fs-jetpack&#39; is a CommonJS module, which may not support all module.exports as named exports.</span></span>
<span class="line"><span>CommonJS modules can always be imported via the default export.</span></span></code></pre></div><p>Vitest 不进行静态分析，并且不会在你运行代码之前失败，因此当该特性禁用时你在运行测试时很可能会看到此错误：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>TypeError: createAsyncThunk is not a function</span></span>
<span class="line"><span>TypeError: default is not a function</span></span></code></pre></div><p>如果你使用的是绕过此 Node.js 限制的捆绑器或转译器，则可以手动启用此选项。默认情况下，当 <code>environment</code> 为 <code>node</code> 时，Vitest 假定你使用的是 Node ESM 语法，并且不关心命名导出。</p><h4 id="deps-moduledirectories" tabindex="-1">deps.moduleDirectories <a class="header-anchor" href="#deps-moduledirectories" aria-label="Permalink to “deps.moduleDirectories”">​</a></h4><ul><li><strong>类型:</strong> <code>string[]</code></li><li><strong>默认值</strong>: <code>[&#39;node_modules&#39;]</code></li></ul><p>配置一个视为模块目录的目录列表。此配置选项会影响 <a href="/api/vi.html#vi-mock"><code>vi.mock</code></a> 的行为：当未提供工厂并且你正在模拟的路径与 <code>moduleDirectories</code> 值之一匹配时，Vitest 将尝试 通过在项目的 <a href="/config/#root">root</a> 中查找 <code>__mocks__</code> 文件夹来解析 mock。</p><p>此选项还将影响在外部化依赖项时是否应将文件视为模块。默认情况下，Vitest 绕过 Vite 转换步骤导入带有原生 Node.js 的外部模块。</p><p>设置此选项将 <em>覆盖</em> 默认值，如果你仍希望搜索 <code>node_modules</code> 包包括它连同任何其他选项：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    deps: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      moduleDirectories: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node_modules&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, path.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;../../packages&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h3 id="runner" tabindex="-1">runner <a class="header-anchor" href="#runner" aria-label="Permalink to “runner”">​</a></h3><ul><li><strong>类型</strong>: <code>VitestRunnerConstructor</code></li><li><strong>默认值</strong>: <code>node</code>, when running tests, or <code>benchmark</code>, when running benchmarks</li></ul><p>自定义测试运行程序的路径。这是一项高级功能，应与自定义库运行器一起使用。你可以在 <a href="/advanced/runner.html">文档</a> 中阅读更多相关信息。</p><h3 id="benchmark" tabindex="-1">benchmark <a class="header-anchor" href="#benchmark" aria-label="Permalink to “benchmark”">​</a></h3><ul><li><strong>类型:</strong> <code>{ include?, exclude?, ... }</code></li></ul><p>运行 <code>vitest bench</code> 时使用的选项。</p><h4 id="benchmark-include" tabindex="-1">benchmark.include <a class="header-anchor" href="#benchmark-include" aria-label="Permalink to “benchmark.include”">​</a></h4><ul><li><strong>类型:</strong> <code>string[]</code></li><li><strong>默认值:</strong> <code>[&#39;**/*.{bench,benchmark}.?(c|m)[jt]s?(x)&#39;]</code></li></ul><p>匹配包含基准测试文件的 glob 规则。</p><h4 id="benchmark-exclude" tabindex="-1">benchmark.exclude <a class="header-anchor" href="#benchmark-exclude" aria-label="Permalink to “benchmark.exclude”">​</a></h4><ul><li><strong>类型:</strong> <code>string[]</code></li><li><strong>默认值:</strong> <code>[&#39;node_modules&#39;, &#39;dist&#39;, &#39;.idea&#39;, &#39;.git&#39;, &#39;.cache&#39;]</code></li></ul><p>匹配排除基准测试文件的 glob 规则。</p><h4 id="benchmark-includesource" tabindex="-1">benchmark.includeSource <a class="header-anchor" href="#benchmark-includesource" aria-label="Permalink to “benchmark.includeSource”">​</a></h4><ul><li><strong>类型:</strong> <code>string[]</code></li><li><strong>默认值:</strong> <code>[]</code></li></ul><p>匹配包含内联基准测试文件的 glob 规则。此选项类似于 <a href="#includesource"><code>includeSource</code></a>。</p><p>定义后，Vitest 将运行所有匹配的文件，其中包含 <code>import.meta.vitest</code>。</p><h4 id="benchmark-reporters" tabindex="-1">benchmark.reporters <a class="header-anchor" href="#benchmark-reporters" aria-label="Permalink to “benchmark.reporters”">​</a></h4><ul><li><strong>类型:</strong> <code>Arrayable&lt;BenchmarkBuiltinReporters | Reporter&gt;</code></li><li><strong>默认值:</strong> <code>&#39;default&#39;</code></li></ul><p>用于定义输出的自定义报告器。它可以包含一个或多个内置报告名称、报告实例和(或)自定义报告的路径。</p><h4 id="benchmark-outputfile" tabindex="-1">benchmark.outputFile <a class="header-anchor" href="#benchmark-outputfile" aria-label="Permalink to “benchmark.outputFile”">​</a></h4><p>已弃用，尝试使用 <code>benchmark.outputJson</code>。</p><h4 id="benchmark-outputJson" tabindex="-1">benchmark.outputJson <a class="header-anchor" href="#benchmark-outputJson" aria-label="Permalink to “benchmark.outputJson”">​</a></h4><ul><li><strong>类型:</strong> <code>string | undefined</code></li><li><strong>默认值:</strong> <code>undefined</code></li></ul><p>存储基准测试结果的文件路径，可用于稍后的 <code>--compare</code> 选项。</p><p>例如:</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 保存主分支的结果。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checkout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> main</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vitest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bench</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --outputJson</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> main.json</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 切换到另一个分支并与主分支进行比较。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> checkout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> feature</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vitest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> bench</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --compare</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> main.json</span></span></code></pre></div><h4 id="benchmark-compare" tabindex="-1">benchmark.compare <a class="header-anchor" href="#benchmark-compare" aria-label="Permalink to “benchmark.compare”">​</a></h4><ul><li><strong>类型:</strong> <code>string | undefined</code></li><li><strong>默认值:</strong> <code>undefined</code></li></ul><p>与当前运行结果进行比较的以前基准结果的文件路径。</p><h3 id="alias" tabindex="-1">alias <a class="header-anchor" href="#alias" aria-label="Permalink to “alias”">​</a></h3><ul><li><strong>类型:</strong> <code>Record&lt;string, string&gt; | Array&lt;{ find: string | RegExp, replacement: string, customResolver?: ResolverFunction | ResolverObject }&gt;</code></li></ul><p>在测试内部运行时定义自定义别名。它们将与来自 <code>resolve.alias</code> 的别名合并。</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>Vitest 使用 Vite SSR 基元来运行测试，这有<a href="https://vitejs.dev/guide/ssr.html#ssr-externals" target="_blank" rel="noreferrer">一定的缺陷</a>。</p><ol><li>别名只影响由<a href="#server-deps-inline">inlined</a>模块直接用<code>import</code>关键字导入的模块（默认情况下所有源代码都是内联的）。</li><li>Vitest 不支持对 <code>require</code> 调用进行别名。</li><li>如果我们要别名外部依赖（例如，<code>react</code> -&gt; <code>preact</code>），我们可能需要别名实际的 <code>node_modules</code> 包，以使其适用于外部依赖。<a href="https://classic.yarnpkg.com/en/docs/cli/add/#toc-yarn-add-alias" target="_blank" rel="noreferrer">Yarn</a> 和 <a href="https://pnpm.io/aliases/" target="_blank" rel="noreferrer">pnpm</a> 都支持通过 <code>npm:</code> 前缀进行别名。</li></ol></div><h3 id="globals" tabindex="-1">globals <a class="header-anchor" href="#globals" aria-label="Permalink to “globals”">​</a></h3><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li><li><strong>命令行终端:</strong> <code>--globals</code>, <code>--globals=false</code></li></ul><p>默认情况下，<code>vitest</code> 不显式提供全局 API。如果你更倾向于使用类似 jest 中的全局 API，可以将 <code>--globals</code> 选项传递给 CLI 或在配置中添加 <code>globals: true</code>。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    globals: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>为了可以让全局 API 支持 TypeScript，请将 <code>vitest/globals</code> 添加到 <code>tsconfig.json</code> 中的 <code>types</code> 选项中</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="tsconfig.json">tsconfig.json</span></div><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;compilerOptions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vitest/globals&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div><p>如果你在 TypeScript 配置中修改了 <a href="https://www.typescriptlang.org/tsconfig/#typeRoots" target="_blank" rel="noreferrer"><code>typeRoots</code></a> ，以便编译时引入更多类型，那么你需要重新把 <code>node_modules</code> 加回到 <code>typeRoots</code> 中，这样才能让 <code>vitest/globals</code> 被正确识别。</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="tsconfig.json">tsconfig.json</span></div><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;compilerOptions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;typeRoots&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./node_modules/@types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./node_modules&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vitest/globals&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div><p>如果你的项目中已经集成了 <a href="https://github.com/antfu/unplugin-auto-import" target="_blank" rel="noreferrer"><code>unplugin-auto-import</code></a> 插件，那么可以直接用它来自动引入这些 API，而无需手动导入。</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="vitest.config.js">vitest.config.js</span></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AutoImport </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;unplugin-auto-import/vite&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  plugins: [</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    AutoImport</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      imports: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;vitest&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      dts: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// generate TypeScript declaration</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></div><h3 id="environment" tabindex="-1">environment <a class="header-anchor" href="#environment" aria-label="Permalink to “environment”">​</a></h3><ul><li><strong>类型:</strong> <code>&#39;node&#39; | &#39;jsdom&#39; | &#39;happy-dom&#39; | &#39;edge-runtime&#39; | string</code></li><li><strong>默认值:</strong> <code>&#39;node&#39;</code></li><li><strong>命令行终端:</strong> <code>--environment=&lt;env&gt;</code></li></ul><p>Vitest 中的默认测试环境是一个 Node.js 环境。如果你正在构建 Web 端应用，你可以使用 <a href="https://github.com/jsdom/jsdom" target="_blank" rel="noreferrer"><code>jsdom</code></a> 或 <a href="https://github.com/capricorn86/happy-dom" target="_blank" rel="noreferrer"><code>happy-dom</code></a> 这种类似浏览器(browser-like)的环境来替代 Node.js。 如果你正在构建边缘计算函数，你可以使用 <a href="https://edge-runtime.vercel.app/packages/vm" target="_blank" rel="noreferrer"><code>edge-runtime</code></a> 环境</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>你还可以使用 <a href="/guide/browser/">浏览器模式</a> 在浏览器中运行集成或单元测试，而无需模拟环境。</p></div><p>你可以通过在文件顶部添加包含 <code>@vitest-environment</code> 的文档块或注释，为某个测试文件中的所有测试指定环境：</p><p>文档块格式:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * @vitest-environment jsdom</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;use jsdom in this test file&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> element</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;div&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(element).not.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBeNull</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>注释格式:</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// @vitest-environment happy-dom</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;use happy-dom in this test file&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> element</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;div&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(element).not.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBeNull</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>为了与 Jest 兼容，还存在一个配置 <code>@jest-environment</code>：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * @jest-environment jsdom</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;use jsdom in this test file&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> element</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> document.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createElement</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;div&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(element).not.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBeNull</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>如果使用 <a href="#isolate"><code>--isolate=false</code></a> 运行 Vitest，测试将按以下顺序运行：<code>node</code>、<code>jsdom</code>、<code>happy-dom</code>、<code>edge-runtime</code>、<code>custom environments</code>。也就是说，具有相同环境的每个测试都会被分组，但仍会按顺序运行。</p><p>从 0.23.0 开始，你还可以定义自定义环境。 当使用非内置环境时，Vitest 将尝试加载包 <code>vitest-environment-\${name}</code>。 该包应导出一个具有 <code>Environment</code> 属性的对象：</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="environment.js">environment.js</span></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Environment } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Environment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;custom&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  viteEnvironment: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ssr&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  setup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // custom setup</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      teardown</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 在所有使用此环境的测试运行完毕后调用。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div><p>Vitest 还通过 <code>vitest/environments</code> 入口导出 <code>builtinEnvironments</code>，以防你只想扩展它。 你可以在 <a href="/guide/environment.html">测试环境指南</a> 中阅读有关扩展测试环境的更多信息。</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>jsdom 环境变量导出了等同于当前<a href="https://github.com/jsdom/jsdom" target="_blank" rel="noreferrer">JSDOM</a> 的 <code>jsdom</code> 全局变量实例。如果你想让 TypeScript 识别它，可以在使用此环境时将 <code>vitest/jsdom</code>添加到 <code>tsconfig.json</code> 中：</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="tsconfig.json">tsconfig.json</span></div><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;compilerOptions&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;types&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vitest/jsdom&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div></div><h3 id="environmentoptions" tabindex="-1">environmentOptions <a class="header-anchor" href="#environmentoptions" aria-label="Permalink to “environmentOptions”">​</a></h3><ul><li><strong>类型:</strong> <code>Record&lt;&#39;jsdom&#39; | string, unknown&gt;</code></li><li><strong>默认值:</strong> <code>{}</code></li></ul><p>这些选项被传递给当前 <a href="#environment"><code>environment</code></a> 的 <code>setup</code> 方法。 默认情况下，如果你将其用作测试环境，则只能配置 JSDOM 选项。</p>`,97)),i("h3",b,[s[9]||(s[9]=e("update",-1)),a(n),s[10]||(s[10]=e()),s[11]||(s[11]=i("a",{class:"header-anchor",href:"#update","aria-label":"Permalink to “update”"},"​",-1))]),s[199]||(s[199]=l("<ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li><li><strong>命令行终端:</strong> <code>-u</code>, <code>--update</code>, <code>--update=false</code></li></ul><p>更新快照文件。这将更新所有更改的快照并删除过时的快照。</p>",2)),i("h3",f,[s[12]||(s[12]=e("watch",-1)),a(n),s[13]||(s[13]=e()),s[14]||(s[14]=i("a",{class:"header-anchor",href:"#watch","aria-label":"Permalink to “watch”"},"​",-1))]),s[200]||(s[200]=l("<ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>!process.env.CI &amp;&amp; process.stdin.isTTY</code></li><li><strong>命令行终端:</strong> <code>-w</code>, <code>--watch</code>, <code>--watch=false</code></li></ul><p>启动监听模式</p><p>交互式环境中，默认启用监听模式，除非显式传入 <code>--run</code>。</p><p>在 CI 或非交互式 shell 中，监听模式默认关闭，需手动加此标志开启。</p>",4)),i("h3",m,[s[16]||(s[16]=e("watchTriggerPatterns ",-1)),a(o,null,{default:t(()=>s[15]||(s[15]=[e("3.2.0",-1)])),_:1,__:[15]}),a(n),s[17]||(s[17]=e()),s[18]||(s[18]=i("a",{class:"header-anchor",href:"#watchtriggerpatterns","aria-label":"Permalink to “watchTriggerPatterns 3.2.0”"},"​",-1))]),s[201]||(s[201]=l(`<ul><li><strong>Type:</strong> <code>WatcherTriggerPattern[]</code></li></ul><p>Vitest 依据静态与动态 <code>import</code> 语句生成的模块图来决定重新执行哪些测试。但若测试读取文件系统或向代理拉取数据，这些依赖便无法被自动探测。</p><p>要触发相关测试重新运行，可定义一条正则及一个返回待执行测试文件列表的函数。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    watchTriggerPatterns: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        pattern:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">^</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">src</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\\/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">(mailers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">templates)</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\\/</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">)</span><span style="--shiki-light:#22863A;--shiki-light-font-weight:bold;--shiki-dark:#85E89D;--shiki-dark-font-weight:bold;">\\.</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">(ts</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">html</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">|</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">txt)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">        testsToRun</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          // relative to the root value</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">          return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`./api/tests/mailers/\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">match</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">]</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}.test.ts\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>Returned files should be either absolute or relative to the root. Note that this is a global option, and it cannot be used inside of <a href="/guide/projects.html">project</a> configs.</p></div><h3 id="root" tabindex="-1">root <a class="header-anchor" href="#root" aria-label="Permalink to “root”">​</a></h3><ul><li><strong>类型:</strong> <code>string</code></li><li><strong>命令行终端:</strong> <code>-r &lt;path&gt;</code>, <code>--root=&lt;path&gt;</code></li></ul><p>项目的根目录</p><h3 id="dir" tabindex="-1">dir <a class="header-anchor" href="#dir" aria-label="Permalink to “dir”">​</a></h3><ul><li><strong>类型:</strong> <code>string</code></li><li><strong>命令行终端:</strong> <code>--dir=&lt;path&gt;</code></li><li><strong>默认值:</strong> same as <code>root</code></li></ul><p>扫描测试文件的基本目录。如果我们的根目录覆盖整个项目，我们可以指定此选项以加快测试发现速度</p>`,11)),i("h3",F,[s[19]||(s[19]=e("reporters",-1)),a(n),s[20]||(s[20]=e()),s[21]||(s[21]=i("a",{class:"header-anchor",href:"#reporters","aria-label":"Permalink to “reporters”"},"​",-1))]),s[202]||(s[202]=l('<ul><li><strong>类型:</strong> <code>Reporter | Reporter[]</code></li><li><strong>默认值:</strong> <code>&#39;default&#39;</code></li><li><strong>命令行终端:</strong> <code>--reporter=&lt;name&gt;</code>, <code>--reporter=&lt;name1&gt; --reporter=&lt;name2&gt;</code></li></ul><p>用于输出的自定义 reporters 。 Reporters 可以是 <a href="https://github.com/vitest-dev/vitest/blob/main/packages/vitest/src/node/types/reporter.ts" target="_blank" rel="noreferrer">一个 Reporter 实例</a> 或选择内置的 reporters 字符串：</p><ul><li><code>&#39;default&#39;</code> - 当他们经过测试套件</li><li><code>&#39;basic&#39;</code> - 给定一个类似于 CI 中的默认报告实例</li><li><code>&#39;verbose&#39;</code> - 保持完整的任务树可见</li><li><code>&#39;dot&#39;</code> - 将每个任务显示为一个点</li><li><code>&#39;junit&#39;</code> - JUnit XML 报告器（你可以使用 <code>VITEST_JUNIT_SUITE_NAME</code> 环境变量配置 <code>test suites</code> 标签名称）</li><li><code>&#39;json&#39;</code> - 给出一个简单的 JSON 总结</li><li><code>&#39;html&#39;</code> - 根据 <a href="/guide/ui.html"><code>@vitest/ui</code></a> 输出 HTML 报告</li><li><code>&#39;hanging-process&#39;</code> - 如果 Vitest 无法安全退出进程，则显示挂起进程列表。 这可能是一个复杂的操作，只有在 Vitest 始终无法退出进程时才启用它</li><li>自定义报告的路径 (例如 <code>&#39;./path/to/reporter.ts&#39;</code>, <code>&#39;@scope/reporter&#39;</code>)</li></ul>',3)),i("h3",v,[s[22]||(s[22]=e("outputFile",-1)),a(n),s[23]||(s[23]=e()),s[24]||(s[24]=i("a",{class:"header-anchor",href:"#outputfile","aria-label":"Permalink to “outputFile”"},"​",-1))]),s[203]||(s[203]=l("<ul><li><strong>类型:</strong> <code>string | Record&lt;string, string&gt;</code></li><li><strong>命令行终端:</strong> <code>--outputFile=&lt;path&gt;</code>, <code>--outputFile.json=./path</code></li></ul><p>当指定 <code>--reporter=json</code>、<code>--reporter=html</code> 或 <code>--reporter=junit</code> 时，将测试结果写入一个文件。通过提供对象而不是字符串，你可以在使用多个报告器时定义单独的输出。</p>",2)),i("h3",C,[s[25]||(s[25]=e("pool",-1)),a(n),s[26]||(s[26]=e()),s[27]||(s[27]=i("a",{class:"header-anchor",href:"#pool","aria-label":"Permalink to “pool”"},"​",-1))]),s[204]||(s[204]=l("<ul><li><strong>类型:</strong> <code>&#39;threads&#39; | &#39;forks&#39; | &#39;vmThreads&#39; | &#39;vmForks&#39;</code></li><li><strong>默认值:</strong> <code>&#39;forks&#39;</code></li><li><strong>命令行终端:</strong> <code>--pool=threads</code></li></ul><p>用于运行测试的线程池。</p>",2)),i("h4",A,[s[28]||(s[28]=e("threads",-1)),a(n),s[29]||(s[29]=e()),s[30]||(s[30]=i("a",{class:"header-anchor",href:"#threads","aria-label":"Permalink to “threads”"},"​",-1))]),s[205]||(s[205]=l('<p>使用 <a href="https://github.com/tinylibs/tinypool" target="_blank" rel="noreferrer">tinypool</a>（一个轻量级的 <a href="https://github.com/piscinajs/piscina" target="_blank" rel="noreferrer">Piscina</a> 分支）来启用多线程。当使用线程时，你无法使用与进程相关的 API，如 <code>process.chdir()</code> 。一些使用原生语言编写的库，如 Prisma 、<code>bcrypt</code> 和 <code>canvas</code> ，在多线程环境下可能会遇到问题并导致段错误。在这些情况下，建议使用 <code>forks</code> 线程池。</p>',1)),i("h4",x,[s[31]||(s[31]=e("forks",-1)),a(n),s[32]||(s[32]=e()),s[33]||(s[33]=i("a",{class:"header-anchor",href:"#forks","aria-label":"Permalink to “forks”"},"​",-1))]),s[206]||(s[206]=l('<p>与 <code>threads</code> 线程池类似，但是使用 <code>child_process</code> 而不是 <code>worker_threads</code> ，通过 <a href="https://github.com/tinylibs/tinypool" target="_blank" rel="noreferrer">tinypool</a> 实现。与 <code>threads</code> 线程池相比，测试与主进程之间的通信速度不够快。在 <code>forks</code> 线程池中，可以使用与进程相关的 API ，如 <code>process.chdir()</code> 。</p>',1)),i("h4",T,[s[34]||(s[34]=e("vmThreads",-1)),a(n),s[35]||(s[35]=e()),s[36]||(s[36]=i("a",{class:"header-anchor",href:"#vmthreads","aria-label":"Permalink to “vmThreads”"},"​",-1))]),s[207]||(s[207]=l(`<p>在 <code>threads</code> 线程池中使用<a href="https://nodejs.org/api/vm.html" target="_blank" rel="noreferrer"> VM 上下文</a>（在受限环境中）运行测试。</p><p>这样可以加快测试速度，但是当运行<a href="https://github.com/nodejs/node/issues/37648" target="_blank" rel="noreferrer"> ESM 代码</a>时，VM 模块可能不稳定。你的测试可能会<a href="https://github.com/nodejs/node/issues/33439" target="_blank" rel="noreferrer">泄漏内存</a>，为了解决这个问题，考虑手动编辑 <a href="#pooloptions-vmthreads-memorylimit"><code>poolOptions.vmThreads.memoryLimit</code></a> 的值。</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>在沙箱中运行代码有一些优点（测试速度更快），但也有许多缺点。</p><ul><li>原生模块中的全局变量，例如（<code>fs</code>、<code>path</code>等），与测试环境中存在的全局变量不同。因此，这些原生模块引发的任何错误都将引用与代码中使用的错误构造函数不同的错误构造函数：</li></ul><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">writeFileSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/doesnt exist&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (err) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(err </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">instanceof</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>导入 ES 模块会无限期地缓存它们，如果你有很多上下文（测试文件），这会导致内存泄漏。Node.js 中没有可以清除该缓存的 API。</li><li>在沙盒环境中访问全局变量<a href="https://github.com/nodejs/node/issues/31658" target="_blank" rel="noreferrer">需要更长的时间</a>。</li></ul><p>使用此选项时请注意这些问题。Vitest 团队无法解决我们这边的任何问题。</p></div>`,3)),i("h4",D,[s[37]||(s[37]=e("vmForks",-1)),a(n),s[38]||(s[38]=e()),s[39]||(s[39]=i("a",{class:"header-anchor",href:"#vmforks","aria-label":"Permalink to “vmForks”"},"​",-1))]),s[208]||(s[208]=l('<p>与 <code>vmThreads</code> 池类似，但通过 <a href="https://github.com/tinylibs/tinypool" target="_blank" rel="noreferrer">tinypool</a> 使用 <code>child_process</code> 而不使用 <code>worker_threads</code>。测试与主进程之间的通信速度虽然不如 <code>vmThreads</code> 快。但进程相关的 API（如 <code>process.chdir()</code> ）在 <code>vmForks</code> 中却可以使用。请注意，这个与 <code>vmThreads</code> 中列出的池具有相同的缺陷。</p>',1)),i("h3",B,[s[40]||(s[40]=e("poolOptions",-1)),a(n),s[41]||(s[41]=e()),s[42]||(s[42]=i("a",{class:"header-anchor",href:"#pooloptions","aria-label":"Permalink to “poolOptions”"},"​",-1))]),s[209]||(s[209]=l(`<ul><li><strong>类型:</strong> <code>Record&lt;&#39;threads&#39; | &#39;forks&#39; | &#39;vmThreads&#39; | &#39;vmForks&#39;, {}&gt;</code></li><li><strong>默认值:</strong> <code>{}</code></li></ul><h4 id="pooloptions-threads" tabindex="-1">poolOptions.threads <a class="header-anchor" href="#pooloptions-threads" aria-label="Permalink to “poolOptions.threads”">​</a></h4><p><code>threads</code> 池的选项。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    poolOptions: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      threads: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Threads related options here</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div>`,4)),i("h5",P,[s[43]||(s[43]=e("poolOptions.threads.maxThreads",-1)),a(n),s[44]||(s[44]=e()),s[45]||(s[45]=i("a",{class:"header-anchor",href:"#pooloptions-threads-maxthreads","aria-label":"Permalink to “poolOptions.threads.maxThreads”"},"​",-1))]),s[210]||(s[210]=i("ul",null,[i("li",null,[i("strong",null,"类型:"),e(),i("code",null,"number | string")]),i("li",null,[i("strong",null,"默认值:"),e(),i("em",null,"available CPUs")])],-1)),s[211]||(s[211]=i("p",null,[e("最大线程数或百分比。还可以使用"),i("code",null,"VITEST_MAX_THREADS"),e("环境变量进行设置。")],-1)),i("h5",_,[s[46]||(s[46]=e("poolOptions.threads.minThreads",-1)),a(n),s[47]||(s[47]=e()),s[48]||(s[48]=i("a",{class:"header-anchor",href:"#pooloptions-threads-minthreads","aria-label":"Permalink to “poolOptions.threads.minThreads”"},"​",-1))]),s[212]||(s[212]=l('<ul><li><strong>类型:</strong> <code>number | string</code></li><li><strong>默认值:</strong> <em>available CPUs</em></li></ul><p>最小线程数或百分比。还可以使用<code>VITEST_MIN_THREADS</code>环境变量进行设置。</p><h5 id="pooloptions-threads-singlethread" tabindex="-1">poolOptions.threads.singleThread <a class="header-anchor" href="#pooloptions-threads-singlethread" aria-label="Permalink to “poolOptions.threads.singleThread”">​</a></h5><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li></ul><p>在单个工作线程内使用相同的环境运行所有测试。 这将禁用内置模块隔离（我们的源代码或 <a href="#server-deps-inline">inlined</a> 代码仍将针对每个测试重新评估），但可以提高测试性能。</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>尽管此选项将强制测试一个接一个地运行，但此选项与 Jest 的 <code>--runInBand</code> 不同。 Vitest 使用工作线程不仅可以并行运行测试，还可以提供隔离。 通过禁用此选项，你的测试将按顺序运行，但在相同的全局上下文中，因此你必须自己提供隔离。</p><p>如果你依赖全局状态（前端框架通常这样做）或者你的代码依赖于为每个测试单独定义的环境，这可能会导致各种问题。 但可以提高你的测试速度（最多快 3 倍），这不一定依赖于全局状态，也可以轻松绕过它。</p></div>',6)),i("h5",S,[s[49]||(s[49]=e("poolOptions.threads.useAtomics",-1)),a(n),s[50]||(s[50]=e()),s[51]||(s[51]=i("a",{class:"header-anchor",href:"#pooloptions-threads-useatomics","aria-label":"Permalink to “poolOptions.threads.useAtomics”"},"​",-1))]),s[213]||(s[213]=l('<ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li></ul><p>使用 Atomics 来同步线程。</p><p>这在某些情况下可以提高性能，但可能会导致旧 Node 版本中出现段错误。</p><h5 id="pooloptions-threads-isolate" tabindex="-1">poolOptions.threads.isolate <a class="header-anchor" href="#pooloptions-threads-isolate" aria-label="Permalink to “poolOptions.threads.isolate”">​</a></h5><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>true</code></li></ul><p>隔离每个测试文件的环境。</p>',6)),i("h5",I,[s[52]||(s[52]=e("poolOptions.threads.execArgv",-1)),a(n),s[53]||(s[53]=e()),s[54]||(s[54]=i("a",{class:"header-anchor",href:"#pooloptions-threads-execargv","aria-label":"Permalink to “poolOptions.threads.execArgv”"},"​",-1))]),s[214]||(s[214]=l(`<ul><li><strong>类型:</strong> <code>string[]</code></li><li><strong>默认值:</strong> <code>[]</code></li></ul><p>在线程中向 <code>node</code> 传递附加参数。更多信息，具体可以浏览 <a href="https://nodejs.org/docs/latest/api/cli.html" target="_blank" rel="noreferrer">Command-line API | Node.js</a> 。</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>使用时要小心，因为某些选项（如--prof、--title）可能会导致 worker 崩溃。具体信息可以浏览 <a href="https://github.com/nodejs/node/issues/41103%E3%80%82" target="_blank" rel="noreferrer">https://github.com/nodejs/node/issues/41103。</a></p></div><h4 id="pooloptions-forks" tabindex="-1">poolOptions.forks <a class="header-anchor" href="#pooloptions-forks" aria-label="Permalink to “poolOptions.forks”">​</a></h4><p><code>forks</code> 池的选项。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    poolOptions: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      forks: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // Forks related options here</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div>`,6)),i("h5",V,[s[55]||(s[55]=e("poolOptions.forks.maxForks",-1)),a(n),s[56]||(s[56]=e()),s[57]||(s[57]=i("a",{class:"header-anchor",href:"#pooloptions-forks-maxforks","aria-label":"Permalink to “poolOptions.forks.maxForks”"},"​",-1))]),s[215]||(s[215]=i("ul",null,[i("li",null,[i("strong",null,"类型:"),e(),i("code",null,"number | string")]),i("li",null,[i("strong",null,"默认值:"),e(),i("em",null,"available CPUs")])],-1)),s[216]||(s[216]=i("p",null,[e("最大分支数量或百分比。你也可以使用 "),i("code",null,"VITEST_MAX_FORKS"),e(" 环境变量。")],-1)),i("h5",j,[s[58]||(s[58]=e("poolOptions.forks.minForks",-1)),a(n),s[59]||(s[59]=e()),s[60]||(s[60]=i("a",{class:"header-anchor",href:"#pooloptions-forks-minforks","aria-label":"Permalink to “poolOptions.forks.minForks”"},"​",-1))]),s[217]||(s[217]=l('<ul><li><strong>类型:</strong> <code>number | string</code></li><li><strong>默认值:</strong> <em>available CPUs</em></li></ul><p>最小分支数量或百分比。你也可以使用 <code>VITEST_MIN_FORKS</code> 环境变量。</p><h5 id="pooloptions-forks-isolate" tabindex="-1">poolOptions.forks.isolate <a class="header-anchor" href="#pooloptions-forks-isolate" aria-label="Permalink to “poolOptions.forks.isolate”">​</a></h5><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>true</code></li></ul><p>隔离每个测试文件的环境。</p><h5 id="pooloptions-forks-singlefork" tabindex="-1">poolOptions.forks.singleFork <a class="header-anchor" href="#pooloptions-forks-singlefork" aria-label="Permalink to “poolOptions.forks.singleFork”">​</a></h5><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li></ul><p>在单个子进程中使用相同的环境运行所有测试。 这将禁用内置模块隔离（你的源代码或 <a href="#server-deps-inline">inlined</a> 代码仍将针对每个测试重新评估），但可以提高测试性能。</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>尽管此选项将强制测试一个接一个地运行，但此选项与 Jest 的 <code>--runInBand</code> 不同。 Vitest 使用子进程不仅可以并行运行测试，还可以提供隔离。 通过禁用此选项，你的测试将按顺序运行，但在相同的全局上下文中，因此你必须自己提供隔离。</p><p>如果你依赖全局状态（前端框架通常这样做）或者你的代码依赖于为每个测试单独定义的环境，这可能会导致各种问题。 但可以提高你的测试速度（最多快 3 倍），这不一定依赖于全局状态，也可以轻松绕过它。</p></div>',9)),i("h5",w,[s[61]||(s[61]=e("poolOptions.forks.execArgv",-1)),a(n),s[62]||(s[62]=e()),s[63]||(s[63]=i("a",{class:"header-anchor",href:"#pooloptions-forks-execargv","aria-label":"Permalink to “poolOptions.forks.execArgv”"},"​",-1))]),s[218]||(s[218]=l(`<ul><li><strong>类型:</strong> <code>string[]</code></li><li><strong>默认值:</strong> <code>[]</code></li></ul><p>向子进程中的 <code>node</code> 进程传递附加参数。更多信息，详细信息可以浏览 <a href="https://nodejs.org/docs/latest/api/cli.html" target="_blank" rel="noreferrer">Command-line API | Node.js</a> 。</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>使用时要小心，因为某些选项（如 --prof、--title ）可能会导致 worker 崩溃。详细信息可以浏览 <a href="https://github.com/nodejs/node/issues/41103%E3%80%82" target="_blank" rel="noreferrer">https://github.com/nodejs/node/issues/41103。</a></p></div><h4 id="pooloptions-vmthreads" tabindex="-1">poolOptions.vmThreads <a class="header-anchor" href="#pooloptions-vmthreads" aria-label="Permalink to “poolOptions.vmThreads”">​</a></h4><p><code>vmThreads</code> 池的选项。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    poolOptions: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      vmThreads: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // VM threads related options here</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div>`,6)),i("h5",N,[s[64]||(s[64]=e("poolOptions.vmThreads.maxThreads",-1)),a(n),s[65]||(s[65]=e()),s[66]||(s[66]=i("a",{class:"header-anchor",href:"#pooloptions-vmthreads-maxthreads","aria-label":"Permalink to “poolOptions.vmThreads.maxThreads”"},"​",-1))]),s[219]||(s[219]=i("ul",null,[i("li",null,[i("strong",null,"类型:"),e(),i("code",null,"number | string")]),i("li",null,[i("strong",null,"默认:"),e(),i("em",null,"available CPUs")])],-1)),s[220]||(s[220]=i("p",null,[e("最大线程数或百分比。还可以使用"),i("code",null,"VITEST_MAX_THREADS"),e("环境变量进行设置。")],-1)),i("h5",q,[s[67]||(s[67]=e("poolOptions.vmThreads.minThreads",-1)),a(n),s[68]||(s[68]=e()),s[69]||(s[69]=i("a",{class:"header-anchor",href:"#pooloptions-vmthreads-minthreads","aria-label":"Permalink to “poolOptions.vmThreads.minThreads”"},"​",-1))]),s[221]||(s[221]=i("ul",null,[i("li",null,[i("strong",null,"类型:"),e(),i("code",null,"number | string")]),i("li",null,[i("strong",null,"默认值:"),e(),i("em",null,"available CPUs")])],-1)),s[222]||(s[222]=i("p",null,[e("最小线程数或百分比。还可以使用"),i("code",null,"VITEST_MIN_THREADS"),e("环境变量进行设置。")],-1)),i("h5",R,[s[70]||(s[70]=e("poolOptions.vmThreads.memoryLimit",-1)),a(n),s[71]||(s[71]=e()),s[72]||(s[72]=i("a",{class:"header-anchor",href:"#pooloptions-vmthreads-memorylimit","aria-label":"Permalink to “poolOptions.vmThreads.memoryLimit”"},"​",-1))]),s[223]||(s[223]=l('<ul><li><strong>类型:</strong> <code>string | number</code></li><li><strong>命令行终端:</strong> <code>1 / CPU Cores</code></li></ul><p>指定工作线程被回收之前的内存限制。该值在很大程度上取决于你的运行环境，因此最好手动指定它，而不是依赖默认值。</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>该实现基于 Jest 的 <a href="https://jestjs.io/docs/configuration#workeridlememorylimit-numberstring" target="_blank" rel="noreferrer"><code>workerIdleMemoryLimit</code></a>。</p><p>可以通过多种不同的方式指定限制，无论结果是什么，<code>Math.floor</code> 都用于将其转换为整数值：</p><ul><li><code>&lt;= 1</code> - 该值假定为系统内存的百分比。所以 0.5 将 worker 的内存限制设置为系统总内存的一半。</li><li><code>\\&gt; 1</code> - 假设是固定字节值。由于之前的规则，如果你想要 1 字节的值（我不知道为什么），你可以使用 1.1。</li><li>有单位时 <ul><li><code>50%</code> - 如上，占系统总内存的百分比</li><li><code>100KB</code>, <code>65MB</code>, 等 - 用单位表示固定的内存限制 <ul><li><code>K</code> / <code>KB</code> - Kilobytes (x1000)</li><li><code>KiB</code> - Kibibytes (x1024)</li><li><code>M</code> / <code>MB</code> - Megabytes - <code>MiB</code> - Mebibytes</li><li><code>G</code> / <code>GB</code> - Gigabytes - <code>GiB</code> - Gibibytes</li></ul></li></ul></li></ul></div><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>由于系统内存报告不正确，基于百分比的内存限制<a href="https://github.com/jestjs/jest/issues/11956#issuecomment-1212925677" target="_blank" rel="noreferrer">在 Linux CircleCI 上不起作用</a>。</p></div>',4)),i("h5",O,[s[73]||(s[73]=e("poolOptions.vmThreads.useAtomics",-1)),a(n),s[74]||(s[74]=e()),s[75]||(s[75]=i("a",{class:"header-anchor",href:"#pooloptions-vmthreads-useatomics","aria-label":"Permalink to “poolOptions.vmThreads.useAtomics”"},"​",-1))]),s[224]||(s[224]=i("ul",null,[i("li",null,[i("strong",null,"类型:"),e(),i("code",null,"boolean")]),i("li",null,[i("strong",null,"默认值:"),e(),i("code",null,"false")])],-1)),s[225]||(s[225]=i("p",null,"使用 Atomics 来同步线程。",-1)),s[226]||(s[226]=i("p",null,"这在某些情况下可以提高性能，但可能会在旧的 Node 版本中抛出错误。",-1)),i("h5",M,[s[76]||(s[76]=e("poolOptions.vmThreads.execArgv",-1)),a(n),s[77]||(s[77]=e()),s[78]||(s[78]=i("a",{class:"header-anchor",href:"#pooloptions-vmthreads-execargv","aria-label":"Permalink to “poolOptions.vmThreads.execArgv”"},"​",-1))]),s[227]||(s[227]=l('<ul><li><strong>类型:</strong> <code>string[]</code></li><li><strong>默认值:</strong> <code>[]</code></li></ul><p>将附加参数传递给虚拟机上下文中的 <code>node</code> 进程。更多信息，详细信息可以浏览 <a href="https://nodejs.org/docs/latest/api/cli.html" target="_blank" rel="noreferrer">Command-line API | Node.js</a> 。</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>使用时要小心，因为某些选项（如 --prof、--title ）可能会导致 worker 崩溃。详细信息可以浏览 <a href="https://github.com/nodejs/node/issues/41103%E3%80%82" target="_blank" rel="noreferrer">https://github.com/nodejs/node/issues/41103。</a></p></div>',3)),i("h4",L,[s[79]||(s[79]=e("poolOptions.vmForks",-1)),a(n),s[80]||(s[80]=e()),s[81]||(s[81]=i("a",{class:"header-anchor",href:"#pooloptions-vmforks","aria-label":"Permalink to “poolOptions.vmForks”"},"​",-1))]),s[228]||(s[228]=l(`<p><code>vmForks</code> 池的选项</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    poolOptions: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      vmForks: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // VM forks related options here</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div>`,2)),i("h5",W,[s[82]||(s[82]=e("poolOptions.vmForks.maxForks",-1)),a(n),s[83]||(s[83]=e()),s[84]||(s[84]=i("a",{class:"header-anchor",href:"#pooloptions-vmforks-maxforks","aria-label":"Permalink to “poolOptions.vmForks.maxForks”"},"​",-1))]),s[229]||(s[229]=i("ul",null,[i("li",null,[i("strong",null,"类型:"),e(),i("code",null,"number | string")]),i("li",null,[i("strong",null,"默认值:"),e(),i("em",null,"available CPUs")])],-1)),s[230]||(s[230]=i("p",null,[e("最大线程数或百分比。你也可以使用 "),i("code",null,"VITEST_MAX_FORKS"),e(" 环境变量。")],-1)),i("h5",U,[s[85]||(s[85]=e("poolOptions.vmForks.minForks",-1)),a(n),s[86]||(s[86]=e()),s[87]||(s[87]=i("a",{class:"header-anchor",href:"#pooloptions-vmforks-minforks","aria-label":"Permalink to “poolOptions.vmForks.minForks”"},"​",-1))]),s[231]||(s[231]=i("ul",null,[i("li",null,[i("strong",null,"类型:"),e(),i("code",null,"number | string")]),i("li",null,[i("strong",null,"默认值:"),e(),i("em",null,"available CPUs")])],-1)),s[232]||(s[232]=i("p",null,[e("最小线程数或百分比。你也可以使用 "),i("code",null,"VITEST_MIN_FORKS"),e(" 环境变量。")],-1)),i("h5",z,[s[88]||(s[88]=e("poolOptions.vmForks.memoryLimit",-1)),a(n),s[89]||(s[89]=e()),s[90]||(s[90]=i("a",{class:"header-anchor",href:"#pooloptions-vmforks-memorylimit","aria-label":"Permalink to “poolOptions.vmForks.memoryLimit”"},"​",-1))]),s[233]||(s[233]=i("ul",null,[i("li",null,[i("strong",null,"类型:"),e(),i("code",null,"string | number")]),i("li",null,[i("strong",null,"默认值:"),e(),i("code",null,"1 / CPU Cores")])],-1)),s[234]||(s[234]=i("p",null,[e("指定 Worker 被回收前的内存限制。该值在很大程度上取决于环境，因此最好手动指定，而不是依赖默认值。该值的计算方法查看 "),i("a",{href:"#pooloptions-vmthreads-memorylimit"},[i("code",null,"poolOptions.vmThreads.memoryLimit")])],-1)),i("h5",G,[s[91]||(s[91]=e("poolOptions.vmForks.execArgv",-1)),a(n),s[92]||(s[92]=e()),s[93]||(s[93]=i("a",{class:"header-anchor",href:"#pooloptions-vmforks-execargv","aria-label":"Permalink to “poolOptions.vmForks.execArgv”"},"​",-1))]),s[235]||(s[235]=l('<ul><li><strong>类型:</strong> <code>string[]</code></li><li><strong>默认值:</strong> <code>[]</code></li></ul><p>将附加参数传递给虚拟机上下文中的 <code>node</code> 进程。更多信息，查看 <a href="https://nodejs.org/docs/latest/api/cli.html" target="_blank" rel="noreferrer">Command-line API | Node.js</a> 了解更多详情。。</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>使用时要小心，因为某些选项（如 <code>--prof</code> 、<code>--title</code>）可能会导致 worker 崩溃。查看 <a href="https://github.com/nodejs/node/issues/41103" target="_blank" rel="noreferrer">https://github.com/nodejs/node/issues/41103</a> 了解更多详情。</p></div>',3)),i("h3",J,[s[94]||(s[94]=e("fileParallelism",-1)),a(n),s[95]||(s[95]=e()),s[96]||(s[96]=i("a",{class:"header-anchor",href:"#fileparallelism","aria-label":"Permalink to “fileParallelism”"},"​",-1))]),s[236]||(s[236]=l('<ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>true</code></li><li><strong>命令行终端:</strong> <code>--no-file-parallelism</code>, <code>--fileParallelism=false</code></li></ul><p>所有测试文件应该并行运行。将其设置为 <code>false</code> 将覆盖 <code>maxWorkers</code> 和 <code>minWorkers</code> 选项为 <code>1</code>。</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>此选项不会影响在同一文件中运行的测试。如果你想并行运行这些程序，请在<a href="/api/#describe-concurrent">description</a>或通过<a href="#sequence-concurrent">a config</a> 上使用 <code>concurrent</code> 选项。</p></div>',3)),i("h3",H,[s[97]||(s[97]=e("maxWorkers",-1)),a(n),s[98]||(s[98]=e()),s[99]||(s[99]=i("a",{class:"header-anchor",href:"#maxworkers","aria-label":"Permalink to “maxWorkers”"},"​",-1))]),s[237]||(s[237]=i("ul",null,[i("li",null,[i("strong",null,"类型:"),e(),i("code",null,"number | string")])],-1)),s[238]||(s[238]=i("p",null,[e("运行测试时设置的最大工作线程数或百分比。"),i("code",null,"poolOptions。｛threads，vmThreads｝.maxThreads "),e("/"),i("code",null,"poolOptions.forks.maxForks"),e(" 具有更高的优先级。")],-1)),i("h3",K,[s[100]||(s[100]=e("minWorkers",-1)),a(n),s[101]||(s[101]=e()),s[102]||(s[102]=i("a",{class:"header-anchor",href:"#minworkers","aria-label":"Permalink to “minWorkers”"},"​",-1))]),s[239]||(s[239]=l('<ul><li><strong>类型:</strong> <code>number | string</code></li></ul><p>运行测试时设置的最小工作线程数或百分比。<code>poolOptions.{threads,vmThreads}.minThreads</code>/<code>poolOptions.forks.minForks</code> 具有更高的优先级。</p><h3 id="testtimeout" tabindex="-1">testTimeout <a class="header-anchor" href="#testtimeout" aria-label="Permalink to “testTimeout”">​</a></h3><ul><li><strong>类型:</strong> <code>number</code></li><li><strong>默认值:</strong> <code>5_000</code> in Node.js, <code>15_000</code> if <code>browser.enabled</code> is <code>true</code></li><li><strong>命令行终端:</strong> <code>--test-timeout=5000</code>, <code>--testTimeout=5000</code></li></ul><p>测试的默认超时时间（以毫秒为单位）。使用 <code>0</code> 完全禁用超时。</p><h3 id="hooktimeout" tabindex="-1">hookTimeout <a class="header-anchor" href="#hooktimeout" aria-label="Permalink to “hookTimeout”">​</a></h3><ul><li><strong>类型:</strong> <code>number</code></li><li><strong>默认值:</strong> <code>10_000</code> in Node.js, <code>30_000</code> if <code>browser.enabled</code> is <code>true</code></li><li><strong>命令行终端:</strong> <code>--hook-timeout=10000</code>, <code>--hookTimeout=10000</code></li></ul><p>钩子(hook)的默认超时时间（以毫秒为单位）。使用 <code>0</code> 完全禁用超时。</p>',8)),i("h3",$,[s[103]||(s[103]=e("teardownTimeout",-1)),a(n),s[104]||(s[104]=e()),s[105]||(s[105]=i("a",{class:"header-anchor",href:"#teardowntimeout","aria-label":"Permalink to “teardownTimeout”"},"​",-1))]),s[240]||(s[240]=l("<ul><li><strong>类型:</strong> <code>number</code></li><li><strong>默认值:</strong> <code>1000</code></li><li><strong>命令行终端:</strong> <code>--teardown-timeout=5000</code>, <code>--teardownTimeout=5000</code></li></ul><p>Vitest 关闭时等待关闭的默认超时时间，以毫秒为单位</p>",2)),i("h3",X,[s[106]||(s[106]=e("silent",-1)),a(n),s[107]||(s[107]=e()),s[108]||(s[108]=i("a",{class:"header-anchor",href:"#silent","aria-label":"Permalink to “silent”"},"​",-1))]),s[241]||(s[241]=l(`<ul><li><strong>类型:</strong> <code>boolean | &#39;passed-only&#39;</code></li><li><strong>默认值:</strong> <code>false</code></li><li><strong>命令行终端:</strong> <code>--silent</code>, <code>--silent=false</code></li></ul><p>静默模式下启动测试。</p><p>使用 <code>&#39;passed-only&#39;</code> 来查看失败测试的日志。失败测试的日志在测试完成后打印。</p><h3 id="setupfiles" tabindex="-1">setupFiles <a class="header-anchor" href="#setupfiles" aria-label="Permalink to “setupFiles”">​</a></h3><ul><li><strong>类型:</strong> <code>string | string[]</code></li></ul><p>setup 文件的路径。它们将运行在每个测试文件之前。</p><div class="info custom-block"><p class="custom-block-title">提示</p><p>编辑设置文件将自动触发所有测试的重新运行。</p></div><p>你可以在全局设置文件中使用 <code>process.env.VITEST_POOL_ID</code>（类似整数的字符串）来区分不同的线程。</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>请注意，如果运行 <a href="#isolate"><code>--isolate=false</code></a> ，这个配置文件将在全局范围内多次运行。这意味着每次测试前都要访问同一个全局对象，因此请确保不要重复做同一件事。</p></div><p>比如，你可能依赖于一个全局变量：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { config } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@some-testing-lib&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">globalThis.defined) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  config.plugins </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [myCoolPlugin]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  computeHeavyThing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  globalThis.defined </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// hooks are reset before each suite</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">afterEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  cleanup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">globalThis.resetBeforeEachTest </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span></span></code></pre></div>`,11)),i("h3",Y,[s[110]||(s[110]=e("provide ",-1)),a(o,null,{default:t(()=>s[109]||(s[109]=[e("2.1.0",-1)])),_:1,__:[109]}),s[111]||(s[111]=e()),s[112]||(s[112]=i("a",{class:"header-anchor",href:"#provide","aria-label":"Permalink to “provide 2.1.0”"},"​",-1))]),s[242]||(s[242]=l(`<ul><li><strong>Type:</strong> <code>Partial&lt;ProvidedContext&gt;</code></li></ul><p>使用 <code>inject</code> 方法定义可在测试中访问的值。</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-1871" id="tab-1872" checked><label data-title="vitest.config.js" for="tab-1872">vitest.config.js</label><input type="radio" name="group-1871" id="tab-1873"><label data-title="api.test.js" for="tab-1873">api.test.js</label></div><div class="blocks"><div class="language-ts active"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    provide: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      API_KEY: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;123&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { expect, inject, test } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;api key is defined&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">inject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;API_KEY&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;123&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></div></div><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>属性必须是字符串，值必须是<a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm#supported_types" target="_blank" rel="noreferrer">可序列化</a>，因为该对象将在不同进程之间传输。</p></div><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>如果使用的是 TypeScript，则需要增强 <code>ProvidedContext</code> 类型，以实现类型安全访问：</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="vitest.shims.d.ts">vitest.shims.d.ts</span></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">declare</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> module</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ProvidedContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    API_KEY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// mark this file as a module so augmentation works correctly</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span></code></pre></div></div></div><h3 id="globalsetup" tabindex="-1">globalSetup <a class="header-anchor" href="#globalsetup" aria-label="Permalink to “globalSetup”">​</a></h3><ul><li><strong>类型:</strong> <code>string | string[]</code></li></ul><p>全局的 setup 文件的路径，相对于项目的根目录。</p><p>全局的 setup 文件可以导出命名函数 <code>setup</code> 和 <code>teardown</code> 或返回拆卸函数的 <code>default</code> 函数（<a href="https://github.com/vitest-dev/vitest/blob/main/test/global-setup/vitest.config.ts" target="_blank" rel="noreferrer">示例</a>)。</p><div class="info custom-block"><p class="custom-block-title">提示</p><p>可以存在多个 globalSetup。setup 和 teardown 依次执行，而 teardown 则以相反的顺序执行。</p></div>`,10)),i("div",Q,[s[122]||(s[122]=i("p",{class:"custom-block-title custom-block-title-default"},"WARNING",-1)),s[123]||(s[123]=i("p",null,"全局设置只有在至少有一个正在运行的测试时才运行。这意味着在测试文件更改后，全局安装程序可能会在监视模式下开始运行（测试文件将等待全局安装程序完成后再运行）。",-1)),s[124]||(s[124]=i("p",null,[e("请注意，全局设置在不同的全局范围内运行，因此你的测试无法访问此处定义的变量。悬停，从 1.0.0 开始，你可以通过 "),i("a",{href:"#provide"},[i("code",null,"provide")]),e(" 方法将可序列化数据传递给测试：")],-1)),i("div",Z,[i("div",ss,[s[117]||(s[117]=i("input",{type:"radio",name:"group-1914",id:"tab-1915",checked:""},null,-1)),s[118]||(s[118]=i("label",{"data-title":"example.test.js",for:"tab-1915"},"example.test.js",-1)),s[119]||(s[119]=i("input",{type:"radio",name:"group-1914",id:"tab-1916"},null,-1)),i("label",is,[s[114]||(s[114]=e("globalSetup.ts ",-1)),a(o,null,{default:t(()=>s[113]||(s[113]=[e("3.0.0",-1)])),_:1,__:[113]})]),s[120]||(s[120]=i("input",{type:"radio",name:"group-1914",id:"tab-1917"},null,-1)),i("label",es,[s[116]||(s[116]=e("globalSetup.ts ",-1)),a(o,null,{default:t(()=>s[115]||(s[115]=[e("2.0.0",-1)])),_:1,__:[115]})])]),s[121]||(s[121]=l(`<div class="blocks"><div class="language-ts active"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { inject } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">inject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;wsPort&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3000</span></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { TestProject } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/node&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">project</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TestProject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  project.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">provide</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;wsPort&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">declare</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> module</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ProvidedContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    wsPort</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { GlobalSetupContext } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/node&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">provide</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> GlobalSetupContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  provide</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;wsPort&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">declare</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> module</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ProvidedContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    wsPort</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> number</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div>`,1))])]),s[243]||(s[243]=l(`<p>自 Vitest 3起，我们可以定义一个自定义回调函数，在 Vitest 重新运行测试时被调用。如果该函数是异步的，运行器将在执行测试前等待其完成。请注意，我们不能像 <code>{ onTestsRerun }</code> 那样解构 <code>project</code> ，因为它依赖于上下文环境。</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="globalSetup.ts">globalSetup.ts</span></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { TestProject } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/node&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> setup</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">project</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TestProject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  project.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">onTestsRerun</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> restartDb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div>`,2)),i("h3",as,[s[125]||(s[125]=e("forceRerunTriggers",-1)),a(n),s[126]||(s[126]=e()),s[127]||(s[127]=i("a",{class:"header-anchor",href:"#forcereruntriggers","aria-label":"Permalink to “forceRerunTriggers”"},"​",-1))]),s[244]||(s[244]=l(`<ul><li><strong>类型</strong>: <code>string[]</code></li><li><strong>默认值:</strong> <code>[&#39;**/package.json/**&#39;, &#39;**/vitest.config.*/**&#39;, &#39;**/vite.config.*/**&#39;]</code></li></ul><p>将触发整个套件重新运行的文件路径的全局 glob 模式。 如果在 git diff 中找到触发器，则与 --changed 参数配对时，将运行整个测试套件。</p><p>如果你正在测试调用 CLI 命令时很有用，因为 Vite 无法构建模块依赖树:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;execute a script&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // Vitest cannot rerun this test, if content of \`dist/index.js\` changes</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> execa</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;dist/index.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">提醒</p><p>请确保我们的文件没有被 <a href="https://vitejs.dev/config/server-options.html#server-watch" target="_blank" rel="noreferrer"><code>server.watch.ignored</code></a>排除在外。</p></div>`,5)),i("h3",ns,[s[128]||(s[128]=e("coverage",-1)),a(n),s[129]||(s[129]=e()),s[130]||(s[130]=i("a",{class:"header-anchor",href:"#coverage","aria-label":"Permalink to “coverage”"},"​",-1))]),s[245]||(s[245]=l(`<p>你可以选择 <a href="/guide/coverage.html#v8-provider"><code>v8</code></a>、<a href="/guide/coverage.html#istanbul-provider"><code>istanbul</code></a> ，或者 <a href="/guide/coverage.html#custom-coverage-provider">自定义覆盖率工具</a> 来进行代码覆盖率统计。</p><p>你可以使用点符号向 CLI 提供覆盖选项：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vitest</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --coverage.enabled</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --coverage.provider=istanbul</span></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>如果你使用带点符号的覆盖选项，请不要忘记指定 <code>--coverage.enabled</code>。 在这种情况下，不要提供单个 --coverage 选项。</p></div><h4 id="coverage-provider" tabindex="-1">coverage.provider <a class="header-anchor" href="#coverage-provider" aria-label="Permalink to “coverage.provider”">​</a></h4><ul><li><strong>类型:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39; | &#39;custom&#39;</code></li><li><strong>默认值:</strong> <code>&#39;v8&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.provider=&lt;provider&gt;</code></li></ul><p>使用 <code>provider</code> 选择收集测试覆盖率的工具。</p><h4 id="coverage-enabled" tabindex="-1">coverage.enabled <a class="header-anchor" href="#coverage-enabled" aria-label="Permalink to “coverage.enabled”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.enabled</code>, <code>--coverage.enabled=false</code></li></ul><p>是否启用收集测试覆盖率。可以使用 <code>--coverage</code> 覆盖 CLI 选项。</p><h4 id="coverage-include" tabindex="-1">coverage.include <a class="header-anchor" href="#coverage-include" aria-label="Permalink to “coverage.include”">​</a></h4><ul><li><strong>类型:</strong> <code>string[]</code></li><li><strong>默认值:</strong> 在执行测试过程中所引入的文件。</li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.include=&lt;pattern&gt;</code>, <code>--coverage.include=&lt;pattern1&gt; --coverage.include=&lt;pattern2&gt;</code></li></ul><p>以 glob 模式指定需要统计覆盖率的文件列表。默认情况下，只有被测试实际执行到的文件会被纳入覆盖率统计。</p><p>建议在 glob 模式中明确包含文件扩展名。</p><p>可以参考 <a href="/guide/coverage.html#including-and-excluding-files-from-coverage-report">如何在覆盖率报告中包含或排除文件</a> 里的示例。</p><h4 id="coverage-exclude" tabindex="-1">coverage.exclude <a class="header-anchor" href="#coverage-exclude" aria-label="Permalink to “coverage.exclude”">​</a></h4><ul><li><strong>类型:</strong> <code>string[]</code></li><li><strong>默认值:</strong> : <code>[]</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.exclude=&lt;path&gt;</code>, <code>--coverage.exclude=&lt;path1&gt; --coverage.exclude=&lt;path2&gt;</code></li></ul><p>想要查看示例，请参考 <a href="/guide/coverage.html#including-and-excluding-files-from-coverage-report">如何在覆盖率报告中包含或排除文件</a>。</p><h4 id="coverage-clean" tabindex="-1">coverage.clean <a class="header-anchor" href="#coverage-clean" aria-label="Permalink to “coverage.clean”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>true</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.clean</code>, <code>--coverage.clean=false</code></li></ul><p>运行测试之前是否清除覆盖率结果</p><h4 id="coverage-cleanonrerun" tabindex="-1">coverage.cleanOnRerun <a class="header-anchor" href="#coverage-cleanonrerun" aria-label="Permalink to “coverage.cleanOnRerun”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>true</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.cleanOnRerun</code>, <code>--coverage.cleanOnRerun=false</code></li></ul><p>监视重新运行时是否清除覆盖率报告。设置为 <code>false</code> 可保留观察模式下上次运行的覆盖结果。</p><h4 id="coverage-reportsdirectory" tabindex="-1">coverage.reportsDirectory <a class="header-anchor" href="#coverage-reportsdirectory" aria-label="Permalink to “coverage.reportsDirectory”">​</a></h4><ul><li><strong>类型:</strong> <code>string</code></li><li><strong>默认值:</strong> <code>&#39;./coverage&#39;</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.reportsDirectory=&lt;path&gt;</code></li></ul><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>如果启用了 <code>coverage.clean</code>（默认值），Vitest 会在运行测试前删除此目录。</p></div><p>配置测试覆盖率报告写入的目录。</p><p>要预览覆盖范围报告，请使用 <a href="/guide/reporters.html#html-reporter">HTML reporter</a>, 该选项必须设置为 html 报告目录的子目录 (比如 <code>./html/coverage</code>).</p><h4 id="coverage-reporter" tabindex="-1">coverage.reporter <a class="header-anchor" href="#coverage-reporter" aria-label="Permalink to “coverage.reporter”">​</a></h4><ul><li><strong>类型:</strong> <code>string | string[] | [string, {}][]</code></li><li><strong>默认值:</strong> <code>[&#39;text&#39;, &#39;html&#39;, &#39;clover&#39;, &#39;json&#39;]</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.reporter=&lt;reporter&gt;</code>, <code>--coverage.reporter=&lt;reporter1&gt; --coverage.reporter=&lt;reporter2&gt;</code></li></ul><p>配置要使用的测试覆盖率报告器。查看 <a href="https://istanbul.js.org/docs/advanced/alternative-reporters/" target="_blank" rel="noreferrer">istanbul 文档</a> 来了解报告详情。有关报告特定选项的详细信息，请参阅 <a href="https://github.com/DefinitelyTyped/DefinitelyTyped/blob/276d95e4304b3670eaf6e8e5a7ea9e265a14e338/types/istanbul-reports/index.d.ts" target="_blank" rel="noreferrer"><code>@types/istanbul-reporter</code></a>。</p><p>该报告器支持三种不同的类型:</p><ul><li>单个报告器: <code>{ reporter: &#39;html&#39; }</code></li><li>无配置的多个报告器: <code>{ reporter: [&#39;html&#39;, &#39;json&#39;] }</code></li><li>有配置的单个或多个报告器: <div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  reporter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;lcov&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { projectRoot: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./src&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { file: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;coverage.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;text&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li></ul><p>我们还可以传递自定义覆盖报告器。查看<a href="/guide/coverage.html#自定义覆盖率提供者">自定义覆盖报告器</a>了解更多详情。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  reporter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Specify reporter using name of the NPM package</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;@vitest/custom-coverage-reporter&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;@vitest/custom-coverage-reporter&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { someOption: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }],</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Specify reporter using local path</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;/absolute/path/to/custom-reporter.cjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/absolute/path/to/custom-reporter.cjs&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { someOption: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>我们可以在 Vitest UI 中查看覆盖率报告：查看 <a href="/guide/coverage.html#vitest-ui">Vitest UI Coverage</a> 了解更多详情。</p><h4 id="coverage-reportonfailure" tabindex="-1">coverage.reportOnFailure <a class="header-anchor" href="#coverage-reportonfailure" aria-label="Permalink to “coverage.reportOnFailure”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.reportOnFailure</code>, <code>--coverage.reportOnFailure=false</code></li></ul><p>即使测试失败也会生成覆盖率报告。</p><h4 id="coverage-allowexternal" tabindex="-1">coverage.allowExternal <a class="header-anchor" href="#coverage-allowexternal" aria-label="Permalink to “coverage.allowExternal”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.allowExternal</code>, <code>--coverage.allowExternal=false</code></li></ul><p>收集 <a href="#root">项目<code>root</code></a> 之外文件的覆盖率。</p>`,43)),i("h4",ls,[s[132]||(s[132]=e("coverage.excludeAfterRemap ",-1)),a(o,null,{default:t(()=>s[131]||(s[131]=[e("2.1.0",-1)])),_:1,__:[131]}),s[133]||(s[133]=e()),s[134]||(s[134]=i("a",{class:"header-anchor",href:"#coverage-exclude-after-remap","aria-label":"Permalink to “coverage.excludeAfterRemap 2.1.0”"},"​",-1))]),s[246]||(s[246]=l(`<ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.excludeAfterRemap</code>, <code>--coverage.excludeAfterRemap=false</code></li></ul><p>在覆盖范围重新映射到原始源后再次应用排除。 当你的源文件被转译并且可能包含非源文件的源映射时，这很有用。</p><p>当你看到报告中显示的文件与你的 <code>coverage.exclude</code> 模式匹配时，请使用此选项。</p><h4 id="coverage-skipfull" tabindex="-1">coverage.skipFull <a class="header-anchor" href="#coverage-skipfull" aria-label="Permalink to “coverage.skipFull”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.skipFull</code>, <code>--coverage.skipFull=false</code></li></ul><p>是否显示具有 100% 语句、分支和函数的测试覆盖率的文件。</p><h4 id="coverage-thresholds" tabindex="-1">coverage.thresholds <a class="header-anchor" href="#coverage-thresholds" aria-label="Permalink to “coverage.thresholds”">​</a></h4><p>覆盖率阈值选项。</p><p>如果将阈值设置为正数，则将其解释为所需的最小覆盖率百分比。例如，将行阈值设置为 <code>90</code> 意味着必须覆盖 90% 的行。</p><p>如果将阈值设置为负数，则将其视为允许的最大未覆盖项数量。例如，将行阈值设置为 <code>-10</code> 意味着未覆盖的行数不得超过 10 行。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  coverage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    thresholds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Requires 90% function coverage</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      functions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">90</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Require that no more than 10 lines are uncovered</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      lines</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h5 id="coverage-thresholds-lines" tabindex="-1">coverage.thresholds.lines <a class="header-anchor" href="#coverage-thresholds-lines" aria-label="Permalink to “coverage.thresholds.lines”">​</a></h5><ul><li><strong>类型:</strong> <code>number</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.thresholds.lines=&lt;number&gt;</code></li></ul><p>lines 的全局阈值。</p><h5 id="coverage-thresholds-functions" tabindex="-1">coverage.thresholds.functions <a class="header-anchor" href="#coverage-thresholds-functions" aria-label="Permalink to “coverage.thresholds.functions”">​</a></h5><ul><li><strong>类型:</strong> <code>number</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.thresholds.functions=&lt;number&gt;</code></li></ul><p>functions 的全局阈值。</p><h5 id="coverage-thresholds-branches" tabindex="-1">coverage.thresholds.branches <a class="header-anchor" href="#coverage-thresholds-branches" aria-label="Permalink to “coverage.thresholds.branches”">​</a></h5><ul><li><strong>类型:</strong> <code>number</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.thresholds.branches=&lt;number&gt;</code></li></ul><p>branches 的全局阈值。</p><h5 id="coverage-thresholds-statements" tabindex="-1">coverage.thresholds.statements <a class="header-anchor" href="#coverage-thresholds-statements" aria-label="Permalink to “coverage.thresholds.statements”">​</a></h5><ul><li><strong>类型:</strong> <code>number</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.thresholds.statements=&lt;number&gt;</code></li></ul><p>statements 的全局阈值。</p><h5 id="coverage-thresholds-perfile" tabindex="-1">coverage.thresholds.perFile <a class="header-anchor" href="#coverage-thresholds-perfile" aria-label="Permalink to “coverage.thresholds.perFile”">​</a></h5><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.thresholds.perFile</code>, <code>--coverage.thresholds.perFile=false</code></li></ul><p>检查每个文件的阈值。</p><h5 id="coverage-thresholds-autoupdate" tabindex="-1">coverage.thresholds.autoUpdate <a class="header-anchor" href="#coverage-thresholds-autoupdate" aria-label="Permalink to “coverage.thresholds.autoUpdate”">​</a></h5><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.thresholds.autoUpdate=&lt;boolean&gt;</code></li></ul><p>如果当前覆盖率优于配置的阈值时，将所有阈值 <code>lines</code>、<code>functions</code>、<code>branches</code> 和 <code>statements</code> 更新到配置文件中。 此选项有助于在覆盖率提高时保持阈值不变。</p><h5 id="coverage-thresholds-100" tabindex="-1">coverage.thresholds.100 <a class="header-anchor" href="#coverage-thresholds-100" aria-label="Permalink to “coverage.thresholds.100”">​</a></h5><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.thresholds.100</code>, <code>--coverage.thresholds.100=false</code></li></ul><p>将全局阈值设置为 100。 这是 <code>--coverage.thresholds.lines 100 --coverage.thresholds.functions 100 --coverage.thresholds.branches 100 --coverage.thresholds.statements 100</code> 的快捷方式。</p><h5 id="coverage-thresholds-glob-pattern" tabindex="-1">coverage.thresholds[glob-pattern] <a class="header-anchor" href="#coverage-thresholds-glob-pattern" aria-label="Permalink to “coverage.thresholds[glob-pattern]”">​</a></h5><ul><li><strong>类型:</strong> <code>{ statements?: number functions?: number branches?: number lines?: number }</code></li><li><strong>默认值:</strong> <code>undefined</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li></ul><p>设置与 glob 模式匹配的文件的阈值。</p><div class="tip custom-block"><p class="custom-block-title">NOTE</p><p>Vitest 会将所有文件，包括那些被 glob 模式覆盖的文件，计入全局覆盖率阈值。 这与 Jest 的行为不同。</p></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  coverage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    thresholds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Thresholds for all files</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      functions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">95</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">70</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Thresholds for matching glob pattern</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;src/utils/**.ts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        statements: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">95</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        functions: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">90</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        branches: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">85</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        lines: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Files matching this pattern will only have lines thresholds set.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Global thresholds are not inherited.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;**/math.ts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        lines: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>`,37)),i("h5",ts,[s[136]||(s[136]=e("coverage.thresholds[glob-pattern].100 ",-1)),a(o,null,{default:t(()=>s[135]||(s[135]=[e("2.1.0",-1)])),_:1,__:[135]}),s[137]||(s[137]=e()),s[138]||(s[138]=i("a",{class:"header-anchor",href:"#coverage-thresholds-glob-pattern-100","aria-label":"Permalink to “coverage.thresholds[glob-pattern].100 2.1.0”"},"​",-1))]),s[247]||(s[247]=l(`<ul><li><strong>Type:</strong> <code>boolean</code></li><li><strong>Default:</strong> <code>false</code></li><li><strong>Available for providers:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li></ul><p>Sets thresholds to 100 for files matching the glob pattern.</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  coverage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    thresholds</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Thresholds for all files</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      functions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">95</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">70</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Thresholds for matching glob pattern</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;src/utils/**.ts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;**/math.ts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="coverage-ignoreclassmethods" tabindex="-1">coverage.ignoreClassMethods <a class="header-anchor" href="#coverage-ignoreclassmethods" aria-label="Permalink to “coverage.ignoreClassMethods”">​</a></h4><ul><li><strong>类型:</strong> <code>string[]</code></li><li><strong>默认值:</strong> <code>[]</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.ignoreClassMethods=&lt;method&gt;</code></li></ul><p>设置为要忽略覆盖率的类方法名称数组。参考 <a href="https://github.com/istanbuljs/nyc#ignoring-methods" target="_blank" rel="noreferrer">istanbul 文档</a> 来了解详情。</p><h4 id="coverage-watermarks" tabindex="-1">coverage.watermarks <a class="header-anchor" href="#coverage-watermarks" aria-label="Permalink to “coverage.watermarks”">​</a></h4><ul><li><strong>类型:</strong></li></ul><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  statements</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [number, number],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  functions</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [number, number],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  branches</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [number, number],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  lines</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [number, number]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li><strong>默认值:</strong></li></ul><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  statements</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  functions</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  branches</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  lines</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.watermarks.statements=50,80</code>， <code>--coverage.watermarks.branches=50,80</code></li></ul><p>语句、行、分支和函数的水印。有关更多信息，请参见 <a href="https://github.com/istanbuljs/nyc#high-and-low-watermarks" target="_blank" rel="noreferrer">istanbul 文档</a>。</p><h4 id="coverage-processingconcurrency" tabindex="-1">coverage.processingConcurrency <a class="header-anchor" href="#coverage-processingconcurrency" aria-label="Permalink to “coverage.processingConcurrency”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>Math.min(20, os.availableParallelism?.() ?? os.cpus().length)</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;v8&#39; | &#39;istanbul&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.processingConcurrency=&lt;number&gt;</code></li></ul><p>处理覆盖率结果时使用的并发限制。</p><h4 id="coverage-customprovidermodule" tabindex="-1">coverage.customProviderModule <a class="header-anchor" href="#coverage-customprovidermodule" aria-label="Permalink to “coverage.customProviderModule”">​</a></h4><ul><li><strong>类型:</strong> <code>string</code></li><li><strong>可用的测试提供者:</strong> <code>&#39;custom&#39;</code></li><li><strong>命令行终端:</strong> <code>--coverage.customProviderModule=&lt;path or module name&gt;</code></li></ul><p>指定自定义覆盖率提供者的模块名称或路径。有关详细信息，请参阅<a href="/guide/coverage.html#custom-coverage-provider">指南 - 自定义覆盖率提供者</a>。</p>`,19)),i("h3",os,[s[139]||(s[139]=e("testNamePattern",-1)),a(n),s[140]||(s[140]=e()),s[141]||(s[141]=i("a",{class:"header-anchor",href:"#testnamepattern","aria-label":"Permalink to “testNamePattern”"},"​",-1))]),s[248]||(s[248]=l(`<ul><li><strong>类型</strong> <code>string | RegExp</code></li><li><strong>命令行终端:</strong> <code>-t &lt;pattern&gt;</code>, <code>--testNamePattern=&lt;pattern&gt;</code>, <code>--test-name-pattern=&lt;pattern&gt;</code></li></ul><p>使用与模式匹配的全名运行测试。 如果你将 <code>OnlyRunThis</code> 添加到此属性，将跳过测试名称中不包含单词 <code>OnlyRunThis</code> 的测试。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { expect, test } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// run</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;OnlyRunThis&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// skipped</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;doNotRun&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toBe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div>`,3)),i("h3",rs,[s[142]||(s[142]=e("open",-1)),a(n),s[143]||(s[143]=e()),s[144]||(s[144]=i("a",{class:"header-anchor",href:"#open","aria-label":"Permalink to “open”"},"​",-1))]),s[249]||(s[249]=l('<ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>!process.env.CI</code></li><li><strong>命令行终端:</strong> <code>--open</code>, <code>--open=false</code></li></ul><p>打开 Vitest UI (WIP: 赞助者计划可用)</p><h3 id="api" tabindex="-1">api <a class="header-anchor" href="#api" aria-label="Permalink to “api”">​</a></h3><ul><li><strong>类型:</strong> <code>boolean | number</code></li><li><strong>默认值:</strong> <code>false</code></li><li><strong>命令行终端:</strong> <code>--api</code>, <code>--api.port</code>, <code>--api.host</code>, <code>--api.strictPort</code></li></ul><p>提供 API 服务的端口。当设置为 true 时，默认端口为 51204</p>',5)),i("h3",ps,[s[146]||(s[146]=e("browser ",-1)),a(r,{type:"warning"},{default:t(()=>s[145]||(s[145]=[e("experimental",-1)])),_:1,__:[145]}),s[147]||(s[147]=e()),s[148]||(s[148]=i("a",{class:"header-anchor",href:"#browser","aria-label":"Permalink to “browser experimental”"},"​",-1))]),s[250]||(s[250]=l('<ul><li><strong>默认值:</strong> <code>{ enabled: false }</code></li><li><strong>命令行终端:</strong> <code>--browser=&lt;name&gt;</code>, <code>--browser.name=chrome --browser.headless</code></li></ul><p>运行浏览器测试的配置。请参阅<a href="/guide/browser/config.html">“浏览器配置参考”</a>。</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>这是一项实验性功能。重大更改可能不会遵循 semver，请在使用时锁定 Vitest 的版本。</p></div><h3 id="clearmocks" tabindex="-1">clearMocks <a class="header-anchor" href="#clearmocks" aria-label="Permalink to “clearMocks”">​</a></h3><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li></ul><p>每个测试开始前自动调用 <a href="/api/vi.html#vi-clearallmocks"><code>vi.clearAllMocks()</code></a>，仅清除 mock 调用记录，不影响其实现。</p><h3 id="mockreset" tabindex="-1">mockReset <a class="header-anchor" href="#mockreset" aria-label="Permalink to “mockReset”">​</a></h3><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li></ul><p>每个测试开始前自动调用 <a href="/api/vi.html#vi-resetallmocks"><code>vi.resetAllMocks()</code></a>，既清空 mock 调用记录，又将所有实现重置。</p><h3 id="restoremocks" tabindex="-1">restoreMocks <a class="header-anchor" href="#restoremocks" aria-label="Permalink to “restoreMocks”">​</a></h3><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li></ul><p>每个测试开始前自动调用 <a href="/api/vi.html#vi-restoreallmocks"><code>vi.restoreAllMocks()</code></a>，恢复所有由 <a href="#vi-spyon"><code>vi.spyOn</code></a> 创建的 spy 的原始实现。</p><h3 id="unstubenvs" tabindex="-1">unstubEnvs <a class="header-anchor" href="#unstubenvs" aria-label="Permalink to “unstubEnvs”">​</a></h3><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li></ul><p>将在每次测试前调用 <a href="/api/#vi-unstuballenvs"><code>vi.unstubAllEnvs</code></a>。</p><h3 id="unstubglobals" tabindex="-1">unstubGlobals <a class="header-anchor" href="#unstubglobals" aria-label="Permalink to “unstubGlobals”">​</a></h3><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li></ul><p>将在每次测试前调用 <a href="/api/#vi-unstuballglobals"><code>vi.unstubAllGlobals</code></a>。</p>',18)),i("h3",hs,[s[149]||(s[149]=e("snapshotFormat",-1)),a(n),s[150]||(s[150]=e()),s[151]||(s[151]=i("a",{class:"header-anchor",href:"#snapshotformat","aria-label":"Permalink to “snapshotFormat”"},"​",-1))]),s[251]||(s[251]=l('<ul><li><strong>类型:</strong> <code>PrettyFormatOptions</code></li></ul><p>测试快照的格式选项。这些选项被传递给 <a href="https://www.npmjs.com/package/pretty-format" target="_blank" rel="noreferrer"><code>pretty-format</code></a>。</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>请注意，此对象上的 <code>plugins</code> 字段将被忽略。</p><p>如果你需要通过 pretty-format 插件扩展快照序列器，请使用 <a href="/api/expect.html#expect-addsnapshotserializer"><code>expect.addSnapshotSerializer</code></a> 或 <a href="#snapshotserializers">snapshotSerializers</a> 选项。</p></div>',3)),i("h3",ds,[s[152]||(s[152]=e("snapshotSerializers",-1)),a(n),s[153]||(s[153]=e()),s[154]||(s[154]=i("a",{class:"header-anchor",href:"#snapshotserializers","aria-label":"Permalink to “snapshotSerializers”"},"​",-1))]),s[252]||(s[252]=i("ul",null,[i("li",null,[i("strong",null,"类型:"),e(),i("code",null,"string[]")]),i("li",null,[i("strong",null,"默认值:"),e(),i("code",null,"[]")])],-1)),s[253]||(s[253]=i("p",null,[e("快照测试的快照序列化程序模块的路径列表，如果要添加自定义快照序列化器，则非常有用。有关详细信息，请参阅"),i("a",{href:"/guide/snapshot.html#custom-serializer"},"自定义序列化器"),e("。")],-1)),i("h3",ks,[s[155]||(s[155]=e("resolveSnapshotPath",-1)),a(n),s[156]||(s[156]=e()),s[157]||(s[157]=i("a",{class:"header-anchor",href:"#resolvesnapshotpath","aria-label":"Permalink to “resolveSnapshotPath”"},"​",-1))]),s[254]||(s[254]=l(`<ul><li><strong>类型</strong>: <code>(testPath: string, snapExtension: string, context: { config: SerializedConfig }) =&gt; string</code></li><li><strong>默认值</strong>: stores snapshot files in <code>__snapshots__</code> directory</li></ul><p>覆盖快照的默认路径。例如，要在测试文件旁边存储一下快照：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    resolveSnapshotPath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">testPath</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">snapExtension</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> testPath </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> snapExtension,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h3 id="allowonly" tabindex="-1">allowOnly <a class="header-anchor" href="#allowonly" aria-label="Permalink to “allowOnly”">​</a></h3><ul><li><strong>类型</strong>: <code>boolean</code></li><li><strong>默认值</strong>: <code>!process.env.CI</code></li><li><strong>命令行终端:</strong> <code>--allowOnly</code>, <code>--allowOnly=false</code></li></ul><p>允许标记为 only 的测试和套件。</p>`,6)),i("h3",cs,[s[158]||(s[158]=e("dangerouslyIgnoreUnhandledErrors",-1)),a(n),s[159]||(s[159]=e()),s[160]||(s[160]=i("a",{class:"header-anchor",href:"#dangerouslyignoreunhandlederrors","aria-label":"Permalink to “dangerouslyIgnoreUnhandledErrors”"},"​",-1))]),s[255]||(s[255]=l("<ul><li><strong>类型</strong>: <code>boolean</code></li><li><strong>默认值</strong>: <code>false</code></li><li><strong>命令行终端:</strong> <code>--dangerouslyIgnoreUnhandledErrors</code> <code>--dangerouslyIgnoreUnhandledErrors=false</code></li></ul><p>忽略发生的任何未处理的错误。</p>",2)),i("h3",gs,[s[161]||(s[161]=e("passWithNoTests",-1)),a(n),s[162]||(s[162]=e()),s[163]||(s[163]=i("a",{class:"header-anchor",href:"#passwithnotests","aria-label":"Permalink to “passWithNoTests”"},"​",-1))]),s[256]||(s[256]=l('<ul><li><strong>类型</strong>: <code>boolean</code></li><li><strong>默认值</strong>: <code>false</code></li><li><strong>命令行终端:</strong> <code>--passWithNoTests</code>, <code>--passWithNoTests=false</code></li></ul><p>如果没有找到测试，Vitest 不会失败。</p><h3 id="logheapusage" tabindex="-1">logHeapUsage <a class="header-anchor" href="#logheapusage" aria-label="Permalink to “logHeapUsage”">​</a></h3><ul><li><strong>类型</strong>: <code>boolean</code></li><li><strong>默认值</strong>: <code>false</code></li><li><strong>命令行终端:</strong> <code>--logHeapUsage</code>, <code>--logHeapUsage=false</code></li></ul><p>每次测试后显示堆的使用情况。用于调试内存是否泄漏。</p><h3 id="css" tabindex="-1">css <a class="header-anchor" href="#css" aria-label="Permalink to “css”">​</a></h3><ul><li><strong>类型</strong>: <code>boolean | { include?, exclude?, modules? }</code></li></ul><p>配置是否应处理 CSS。 排除后，CSS 文件将被替换为空字符串以绕过后续处理。 CSS 模块将返回一个代理以不影响运行时。</p><h4 id="css-include" tabindex="-1">css.include <a class="header-anchor" href="#css-include" aria-label="Permalink to “css.include”">​</a></h4><ul><li><strong>类型</strong>: <code>RegExp | RegExp[]</code></li><li><strong>默认值</strong>: <code>[]</code></li></ul><p>将返回匹配正则表达式并将由 Vite 管道处理的实际 CSS 文件。</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>如果需要处理所有 CSS 文件，请使用 <code>/.+/</code>。</p></div><h4 id="css-exclude" tabindex="-1">css.exclude <a class="header-anchor" href="#css-exclude" aria-label="Permalink to “css.exclude”">​</a></h4><ul><li><strong>类型</strong>: <code>RegExp | RegExp[]</code></li><li><strong>默认值</strong>: <code>[]</code></li></ul><p>将返回匹配正则表达式的空 CSS 文件。</p><h4 id="css-modules" tabindex="-1">css.modules <a class="header-anchor" href="#css-modules" aria-label="Permalink to “css.modules”">​</a></h4><ul><li><strong>类型</strong>: <code>{ classNameStrategy? }</code></li><li><strong>默认值</strong>: <code>{}</code></li></ul><h4 id="css-modules-classnamestrategy" tabindex="-1">css.modules.classNameStrategy <a class="header-anchor" href="#css-modules-classnamestrategy" aria-label="Permalink to “css.modules.classNameStrategy”">​</a></h4><ul><li><strong>类型</strong>: <code>&#39;stable&#39; | &#39;scoped&#39; | &#39;non-scoped&#39;</code></li><li><strong>默认值</strong>: <code>&#39;stable&#39;</code></li></ul><p>如果你决定处理 CSS 文件，你可以配置 CSS 模块中的类名是否在限定范围内。 默认情况下，Vitest 会导出一个代理，绕过 CSS 模块处理。 你可以选择以下选项之一：</p><ul><li><code>stable</code>: 类名将生成为<code>_${name}_${hashedFilename}</code>，这意味着如果 CSS 内容发生变化，生成的类将保持不变，但如果文件名被修改，或者文件名将发生变化 被移动到另一个文件夹。 如果你使用快照功能，此设置很有用。</li><li><code>scoped</code>: 类名将照常生成，遵照 <code>css.modules.generateScopedName</code> 方法，如果你有的话。 默认情况下，文件名将生成为<code>_${name}_${hash}</code>，其中 hash 包括文件名和文件内容。</li><li><code>non-scoped</code>: 类名将保留 CSS 中定义的名称。</li></ul><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>在默认的情况下，Vitest 导出代理会绕过 CSS 模块处理。 如果你依赖类的 CSS 属性，就必须使用 <code>include</code> 选项启用 CSS 处理。</p></div><h3 id="maxconcurrency" tabindex="-1">maxConcurrency <a class="header-anchor" href="#maxconcurrency" aria-label="Permalink to “maxConcurrency”">​</a></h3><ul><li><strong>类型</strong>: <code>number</code></li><li><strong>默认值</strong>: <code>5</code></li><li><strong>命令行终端</strong>: <code>--max-concurrency=10</code>, <code>--maxConcurrency=10</code></li></ul><p>使用 <code>test.concurrent</code> 标记允许同时运行的最大测试数量。</p><p>当出现可用插槽时，超过此限制的测试将排队运行。</p>',26)),i("h3",Es,[s[164]||(s[164]=e("cache",-1)),a(n),s[165]||(s[165]=e()),s[166]||(s[166]=i("a",{class:"header-anchor",href:"#cache","aria-label":"Permalink to “cache”"},"​",-1))]),s[257]||(s[257]=l(`<ul><li><strong>类型</strong>: <code>false</code></li><li><strong>命令行终端</strong>: <code>--no-cache</code>, <code>--cache=false</code></li></ul><p>如果要禁用缓存功能，请使用此选项。目前，Vitest 会对测试结果进行缓存，优先运行时间较长和失败的测试。</p><p>缓存目录由 Vite 的 <a href="https://vitejs.dev/config/shared-options.html#cachedir" target="_blank" rel="noreferrer"><code>cacheDir</code></a> 选项控制：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cacheDir: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;custom-folder/.vitest&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>我们可以使用 <code>process.env.VITEST</code> 来限制目录，使其仅用于 Vitest：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  cacheDir: process.env.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">VITEST</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;custom-folder/.vitest&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> :</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h3 id="sequence" tabindex="-1">sequence <a class="header-anchor" href="#sequence" aria-label="Permalink to “sequence”">​</a></h3><ul><li><strong>类型</strong>: <code>{ sequencer?, shuffle?, seed?, hooks?, setupFiles?, groupOrder }</code></li></ul><p>配置测试运行顺序的选项。</p><p>你可以使用点符号向 CLI 提供序列选项：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vitest</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --sequence.shuffle</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --sequence.seed=1000</span></span></code></pre></div>`,11)),i("h4",us,[s[167]||(s[167]=e("sequence.sequencer",-1)),a(n),s[168]||(s[168]=e()),s[169]||(s[169]=i("a",{class:"header-anchor",href:"#sequence-sequencer","aria-label":"Permalink to “sequence.sequencer”"},"​",-1))]),s[258]||(s[258]=l('<ul><li><strong>类型</strong>: <code>TestSequencerConstructor</code></li><li><strong>默认值</strong>: <code>BaseSequencer</code></li></ul><p>定义分片和排序的自定义类。你可以从 <code>vitest/node</code> 扩展 <code>BaseSequencer</code>，如果你只需要重新定义 <code>sort</code> 和 <code>shard</code> 方法之一，但两者都应该存在。</p><p>分片是在排序之前进行的，并且只有提供了 <code>--shard</code> 选项的情况下才会生效。</p><p>If <a href="#grouporder"><code>sequencer.groupOrder</code></a> is specified, the sequencer will be called once for each group and pool.</p>',4)),i("h4",ys,[s[171]||(s[171]=e("groupOrder ",-1)),a(o,null,{default:t(()=>s[170]||(s[170]=[e("3.2.0",-1)])),_:1,__:[170]}),s[172]||(s[172]=e()),s[173]||(s[173]=i("a",{class:"header-anchor",href:"#grouporder","aria-label":"Permalink to “groupOrder 3.2.0”"},"​",-1))]),s[259]||(s[259]=l(`<ul><li><strong>Type:</strong> <code>number</code></li><li><strong>Default:</strong> <code>0</code></li></ul><p>Controls the order in which this project runs its tests when using multiple <a href="/guide/projects.html">projects</a>.</p><ul><li>Projects with the same group order number will run together, and groups are run from lowest to highest.</li><li>If you don’t set this option, all projects run in parallel.</li><li>If several projects use the same group order, they will run at the same time.</li></ul><p>This setting only affects the order in which projects run, not the order of tests within a project. To control test isolation or the order of tests inside a project, use the <a href="#isolate"><code>isolate</code></a> and <a href="#sequence-sequencer"><code>sequence.sequencer</code></a> options.</p><details class="details custom-block"><summary>Example</summary><p>Consider this example:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    projects: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;slow&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          sequence: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            groupOrder: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fast&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          sequence: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            groupOrder: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;flaky&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          sequence: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            groupOrder: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>Tests in these projects will run in this order:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span> 0. slow  |</span></span>
<span class="line"><span>          |&gt; running together</span></span>
<span class="line"><span> 0. fast  |</span></span>
<span class="line"><span></span></span>
<span class="line"><span> 1. flaky |&gt; runs after slow and fast alone</span></span></code></pre></div></details><h4 id="sequence-shuffle" tabindex="-1">sequence.shuffle <a class="header-anchor" href="#sequence-shuffle" aria-label="Permalink to “sequence.shuffle”">​</a></h4><ul><li><strong>类型</strong>: <code>boolean | { files?, tests? }</code></li><li><strong>默认值</strong>: <code>false</code></li><li><strong>命令行终端</strong>: <code>--sequence.shuffle</code>, <code>--sequence.shuffle=false</code></li></ul><p>如果你希望测试随机运行，可以使用此选项或 CLI 参数 <a href="/guide/cli.html"><code>--sequence.shuffle</code></a> 启用它。</p><p>Vitest 通常使用缓存对测试进行排序，因此长时间运行的测试会更早开始 - 这会使测试运行得更快。 如果你的测试将以随机顺序运行，你将失去这种性能改进，但跟踪意外依赖于先前运行的测试可能很有用。</p><ul><li><strong>类型</strong>: <code>boolean | { files?, tests? }</code></li><li><strong>默认值</strong>: <code>false</code></li><li><strong>命令行终端</strong>: <code>--sequence.shuffle</code>, <code>--sequence.shuffle=false</code></li></ul><h4 id="sequence-shuffle-files" tabindex="-1">sequence.shuffle.files <a class="header-anchor" href="#sequence-shuffle-files" aria-label="Permalink to “sequence.shuffle.files”">​</a></h4><ul><li><strong>类型</strong>: <code>boolean</code></li><li><strong>默认值</strong>: <code>false</code></li><li><strong>命令行终端</strong>: <code>--sequence.shuffle.files</code>, <code>--sequence.shuffle.files=false</code></li></ul><p>是否随机化文件，注意如果启用此选项，长时间运行的测试将不会提前启动。</p><h4 id="sequence-shuffle-tests" tabindex="-1">sequence.shuffle.tests <a class="header-anchor" href="#sequence-shuffle-tests" aria-label="Permalink to “sequence.shuffle.tests”">​</a></h4><ul><li><strong>类型</strong>: <code>boolean</code></li><li><strong>默认值</strong>: <code>false</code></li><li><strong>命令行终端</strong>: <code>--sequence.shuffle.tests</code>, <code>--sequence.shuffle.tests=false</code></li></ul><p>是否随机测试。</p><h4 id="sequence-concurrent" tabindex="-1">sequence.concurrent <a class="header-anchor" href="#sequence-concurrent" aria-label="Permalink to “sequence.concurrent”">​</a></h4><ul><li><strong>类型</strong>: <code>boolean</code></li><li><strong>默认值</strong>: <code>false</code></li><li><strong>命令行终端</strong>: <code>--sequence.concurrent</code>, <code>--sequence.concurrent=false</code></li></ul><p>如果你希望测试并行运行，可以使用此选项或 CLI 参数 <a href="/guide/cli.html"><code>--sequence.concurrent</code></a> 启用它。</p>`,19)),i("h4",bs,[s[174]||(s[174]=e("sequence.seed",-1)),a(n),s[175]||(s[175]=e()),s[176]||(s[176]=i("a",{class:"header-anchor",href:"#sequence-seed","aria-label":"Permalink to “sequence.seed”"},"​",-1))]),s[260]||(s[260]=l('<ul><li><strong>类型</strong>: <code>number</code></li><li><strong>默认值</strong>: <code>Date.now()</code></li><li><strong>命令行终端</strong>: <code>--sequence.seed=1000</code></li></ul><p>如果测试以随机顺序运行，则设置随机化种子。</p><h4 id="sequence-hooks" tabindex="-1">sequence.hooks <a class="header-anchor" href="#sequence-hooks" aria-label="Permalink to “sequence.hooks”">​</a></h4><ul><li><strong>类型</strong>: <code>&#39;stack&#39; | &#39;list&#39; | &#39;parallel&#39;</code></li><li><strong>默认值</strong>: <code>&#39;stack&#39;</code></li><li><strong>命令行终端</strong>: <code>--sequence.hooks=&lt;value&gt;</code></li></ul><p>更改钩子的执行顺序。</p><ul><li><code>stack</code> 将以相反的顺序排列 &quot;after&quot; 钩子，&quot;before&quot; 钩子将按照它们定义的顺序运行</li><li><code>list</code> 将按照定义的顺序对所有钩子进行排序</li><li><code>parallel</code> 将并行运行单个组中的钩子（父套件中的钩子仍将在当前套件的钩子之前运行）</li></ul><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>该选项不会影响 <a href="/api/#ontestfinished"><code>onTestFinished</code></a>。它总是以相反的顺序调用。</p></div><h4 id="sequence-setupfiles" tabindex="-1">sequence.setupFiles <a class="header-anchor" href="#sequence-setupfiles" aria-label="Permalink to “sequence.setupFiles”">​</a></h4><ul><li><strong>类型</strong>: <code>&#39;list&#39; | &#39;parallel&#39;</code></li><li><strong>默认值</strong>: <code>&#39;parallel&#39;</code></li><li><strong>命令行终端</strong>: <code>--sequence.setupFiles=&lt;value&gt;</code></li></ul><p>更改安装文件的执行顺序。</p><ul><li><code>list</code> 将按照定义的顺序运行安装文件</li><li><code>parallel</code> 将并行运行设置文件</li></ul><h3 id="typecheck" tabindex="-1">typecheck <a class="header-anchor" href="#typecheck" aria-label="Permalink to “typecheck”">​</a></h3><p>用于配置 <a href="/guide/testing-types.html">typechecking</a> 测试环境的选项。</p><h4 id="typecheck-enabled" tabindex="-1">typecheck.enabled <a class="header-anchor" href="#typecheck-enabled" aria-label="Permalink to “typecheck.enabled”">​</a></h4><ul><li><strong>类型</strong>: <code>boolean</code></li><li><strong>默认值</strong>: <code>false</code></li><li><strong>命令行终端</strong>: <code>--typecheck</code>, <code>--typecheck.enabled</code></li></ul><p>常规测试时是否进行类型检查。</p><h4 id="typecheck-only" tabindex="-1">typecheck.only <a class="header-anchor" href="#typecheck-only" aria-label="Permalink to “typecheck.only”">​</a></h4><ul><li><strong>类型</strong>: <code>boolean</code></li><li><strong>默认值</strong>: <code>false</code></li><li><strong>命令行终端</strong>: <code>--typecheck.only</code></li></ul><p>启用类型检查时，仅运行类型检查测试。使用 CLI 时，此选项将自动启用类型检查。</p><h4 id="typecheck-checker" tabindex="-1">typecheck.checker <a class="header-anchor" href="#typecheck-checker" aria-label="Permalink to “typecheck.checker”">​</a></h4><ul><li><strong>类型</strong>: <code>&#39;tsc&#39; | &#39;vue-tsc&#39; | string</code></li><li><strong>默认值</strong>: <code>tsc</code></li></ul><p>设置类型检查的检测器。Vitest 将根据类型生成具有某些参数的进程，以便于解析。 Checker 应该实现与 <code>tsc</code> 相同的输出格式。</p><p>你需要安装一个包才能使用 typecheker:</p><ul><li><code>tsc</code> requires <code>typescript</code> package</li><li><code>vue-tsc</code> requires <code>vue-tsc</code> package</li></ul><p>你还可以将路径传递到自定义二进制文件或命令名称，该路径会产生与 <code>tsc --noEmit --pretty false</code> 相同的输出。</p><h4 id="typecheck-include" tabindex="-1">typecheck.include <a class="header-anchor" href="#typecheck-include" aria-label="Permalink to “typecheck.include”">​</a></h4><ul><li><strong>类型</strong>: <code>string[]</code></li><li><strong>默认值</strong>: <code>[&#39;**/*.{test,spec}-d.?(c|m)[jt]s?(x)&#39;]</code></li></ul><p>匹配包含测试文件的 glob 规则。</p><h4 id="typecheck-exclude" tabindex="-1">typecheck.exclude <a class="header-anchor" href="#typecheck-exclude" aria-label="Permalink to “typecheck.exclude”">​</a></h4><ul><li><strong>类型</strong>: <code>string[]</code></li><li><strong>默认值</strong>: <code>[&#39;**/node_modules/**&#39;, &#39;**/dist/**&#39;, &#39;**/cypress/**&#39;, &#39;**/.{idea,git,cache,output,temp}/**&#39;]</code></li></ul><p>匹配排除测试文件的 glob 规则。</p><h4 id="typecheck-allowjs" tabindex="-1">typecheck.allowJs <a class="header-anchor" href="#typecheck-allowjs" aria-label="Permalink to “typecheck.allowJs”">​</a></h4><ul><li><strong>类型</strong>: <code>boolean</code></li><li><strong>默认值</strong>: <code>false</code></li></ul><p>检查有 <code>@ts-check</code> 注释的 JS 文件。 如果你在 tsconfig 中启用它，则不会覆盖它。</p><h4 id="typecheck-ignoresourceerrors" tabindex="-1">typecheck.ignoreSourceErrors <a class="header-anchor" href="#typecheck-ignoresourceerrors" aria-label="Permalink to “typecheck.ignoreSourceErrors”">​</a></h4><ul><li><strong>类型</strong>: <code>boolean</code></li><li><strong>默认值</strong>: <code>false</code></li></ul><p>如果 Vitest 在测试文件之外发现错误，不要失败。 这根本不会向你显示非测试错误。</p><p>默认情况下，如果 Vitest 发现源错误，它将测试套件中抛出失败。</p><h4 id="typecheck-tsconfig" tabindex="-1">typecheck.tsconfig <a class="header-anchor" href="#typecheck-tsconfig" aria-label="Permalink to “typecheck.tsconfig”">​</a></h4><ul><li><strong>类型</strong>: <code>string</code></li><li><strong>默认值</strong>: <em>tries to find closest tsconfig.json</em></li></ul><p>自定义 tsconfig 的路径，相对于项目根目录。</p><h4 id="typecheck-spawntimeout" tabindex="-1">typecheck.spawnTimeout <a class="header-anchor" href="#typecheck-spawntimeout" aria-label="Permalink to “typecheck.spawnTimeout”">​</a></h4><ul><li><strong>Type</strong>: <code>number</code></li><li><strong>Default</strong>: <code>10_000</code></li></ul><p>Minimum time in milliseconds it takes to spawn the typechecker.</p>',44)),i("h3",fs,[s[177]||(s[177]=e("slowTestThreshold",-1)),a(n),s[178]||(s[178]=e()),s[179]||(s[179]=i("a",{class:"header-anchor",href:"#slowtestthreshold","aria-label":"Permalink to “slowTestThreshold”"},"​",-1))]),s[261]||(s[261]=l('<ul><li><strong>类型</strong>: <code>number</code></li><li><strong>默认值</strong>: <code>300</code></li><li><strong>命令行终端:</strong>:<code>--slow-test-threshold=&lt;number&gt;</code>, <code>--slowTestThreshold=&lt;number&gt;</code></li></ul><p>如果测试被认为是缓慢的，那么会在报告结果中显示毫秒值。</p><h3 id="chaiconfig" tabindex="-1">chaiConfig <a class="header-anchor" href="#chaiconfig" aria-label="Permalink to “chaiConfig”">​</a></h3><ul><li><strong>类型:</strong> <code>{ includeStack?, showDiff?, truncateThreshold? }</code></li><li><strong>默认值:</strong> <code>{ includeStack: false, showDiff: true, truncateThreshold: 40 }</code></li></ul><p>等同于 <a href="https://github.com/chaijs/chai/blob/4.x.x/lib/chai/config.js" target="_blank" rel="noreferrer">Chai 配置</a>。</p><h4 id="chaiconfig-includestack" tabindex="-1">chaiConfig.includeStack <a class="header-anchor" href="#chaiconfig-includestack" aria-label="Permalink to “chaiConfig.includeStack”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li></ul><p>影响断言错误消息中是否包含堆栈跟踪。默认值为 false，在错误消息中抑制堆栈跟踪。</p><h4 id="chaiconfig-showdiff" tabindex="-1">chaiConfig.showDiff <a class="header-anchor" href="#chaiconfig-showdiff" aria-label="Permalink to “chaiConfig.showDiff”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>true</code></li></ul><p>影响是否应在抛出的 AssertionErrors 中包含 <code>showDiff</code> 标志。<code>false</code> 始终为 <code>false</code>；<code>true</code> 将在断言请求显示差异时为 <code>true</code>。</p><h4 id="chaiconfig-truncatethreshold" tabindex="-1">chaiConfig.truncateThreshold <a class="header-anchor" href="#chaiconfig-truncatethreshold" aria-label="Permalink to “chaiConfig.truncateThreshold”">​</a></h4><ul><li><strong>类型:</strong> <code>number</code></li><li><strong>默认值:</strong> <code>40</code></li></ul><p>设置断言错误中实际值和期望值的长度阈值。如果超过此阈值，例如对于大型数据结构，该值将被替换为类似 <code>[ Array(3) ]</code> 或 <code>{ Object (prop1, prop2) }</code> 的内容。如果要完全禁用截断，请将其设置为 <code>0</code>。</p><p>此配置选项影响在 <code>test.each</code> 标题和断言错误消息中截断值的方式。</p><h3 id="bail" tabindex="-1">bail <a class="header-anchor" href="#bail" aria-label="Permalink to “bail”">​</a></h3><ul><li><strong>类型:</strong> <code>number</code></li><li><strong>默认值:</strong> <code>0</code></li><li><strong>命令行终端</strong>: <code>--bail=&lt;value&gt;</code></li></ul><p>当给定数量的测试失败时停止测试执行。</p><p>默认情况下，即使其中一些测试失败，Vitest 也会运行你的所有测试用例。这可能不适用于 CI 构建，你只对 100% 成功的构建感兴趣，并且希望在测试失败时尽早停止测试执行。<code>bail</code> 选项可用于通过在发生故障时防止运行更多测试来加速 CI 运行。</p><h3 id="retry" tabindex="-1">retry <a class="header-anchor" href="#retry" aria-label="Permalink to “retry”">​</a></h3><ul><li><strong>类型:</strong> <code>number</code></li><li><strong>默认值:</strong> <code>0</code></li><li><strong>命令行终端:</strong> <code>--retry=&lt;value&gt;</code></li></ul><p>如果测试失败，请重试特定次数的测试。</p>',22)),i("h3",ms,[s[180]||(s[180]=e("onConsoleLog",-1)),a(n),s[181]||(s[181]=e()),s[182]||(s[182]=i("a",{class:"header-anchor",href:"#onconsolelog","aria-label":"Permalink to “onConsoleLog”"},"​",-1))]),s[262]||(s[262]=l(`<div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> onConsoleLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;stdout&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;stderr&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">  entity</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TestModule</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TestSuite</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TestCase</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> undefined</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span></span></code></pre></div><p>用于自定义处理测试中调用的 <code>console</code> 方法。如果返回值是 <code>false</code> ， Vitest 将不会将日志打印到控制台。需要注意的是， Vitest 会忽略除 <code>false</code> 之外的其他假值。</p><p>这在过滤掉来自第三方库的日志时会非常有用。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    onConsoleLog</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">log</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;stdout&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;stderr&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(log </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;message from third party library&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> type </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;stdout&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div>`,4)),i("h3",Fs,[s[183]||(s[183]=e("onStackTrace",-1)),a(n),s[184]||(s[184]=e()),s[185]||(s[185]=i("a",{class:"header-anchor",href:"#onstacktrace","aria-label":"Permalink to “onStackTrace”"},"​",-1))]),s[263]||(s[263]=l(`<ul><li><strong>类型</strong>: <code>(error: Error, frame: ParsedStack) =&gt; boolean | void</code></li></ul><p>在处理错误时，对每个堆栈的每个帧应用过滤功能。第一个参数 <code>error</code> 是一个与标准 <code>Error</code> 具有相同属性的对象，但它不是实际实例。</p><p>可用于从第三方库中筛选堆栈跟踪帧。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { ParsedStack } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    onStackTrace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">error</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ParsedStack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // If we&#39;ve encountered a ReferenceError, show the whole stack.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;ReferenceError&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Reject all frames from third party libraries.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (file.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">includes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node_modules&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div>`,4)),i("h3",vs,[s[186]||(s[186]=e("onUnhandledError",-1)),a(n),s[187]||(s[187]=e()),s[188]||(s[188]=i("a",{class:"header-anchor",href:"#onunhandlederror","aria-label":"Permalink to “onUnhandledError”"},"​",-1))]),s[264]||(s[264]=l(`<ul><li><strong>Type:</strong> <code>(error: (TestError | Error) &amp; { type: string }) =&gt; boolean | void</code></li></ul><p>A custom handler to filter out unhandled errors that should not be reported. If an error is filtered out, it will no longer affect the test results.</p><p>If you want unhandled errors to be reported without impacting the test outcome, consider using the <a href="#dangerouslyignoreunhandlederrors"><code>dangerouslyIgnoreUnhandledErrors</code></a> option</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { ParsedStack } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    onUnhandledError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> boolean</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Ignore all errors with the name &quot;MySpecialError&quot;.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (error.name </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;MySpecialError&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> false</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><h3 id="diff" tabindex="-1">diff <a class="header-anchor" href="#diff" aria-label="Permalink to “diff”">​</a></h3><ul><li><strong>类型:</strong> <code>string</code></li><li><strong>命令行终端:</strong> <code>--diff=&lt;path&gt;</code></li></ul><p><code>DiffOptions</code> 对象或者是一个导出 <code>DiffOptions</code> 的模块路径。如果我们想要自定义差异显示，这将非常有用。</p><p>例如，作为一个配置对象：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;picocolors&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    diff: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      aIndicator: c.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bold</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;--&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      bIndicator: c.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bold</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;++&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      omitAnnotationLines: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>Or as a module:</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-3913" id="tab-3914" checked><label data-title="vitest.config.js" for="tab-3914">vitest.config.js</label><input type="radio" name="group-3913" id="tab-3915"><label data-title="vitest.diff.ts" for="tab-3915">vitest.diff.ts</label></div><div class="blocks"><div class="language-ts active"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    diff: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./vitest.diff.ts&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { DiffOptions } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> c </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;picocolors&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  aIndicator: c.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bold</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;--&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  bIndicator: c.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bold</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;++&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  omitAnnotationLines: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">} </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">satisfies</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DiffOptions</span></span></code></pre></div></div></div><h4 id="diff-expand" tabindex="-1">diff.expand <a class="header-anchor" href="#diff-expand" aria-label="Permalink to “diff.expand”">​</a></h4><ul><li><strong>类型</strong>: <code>boolean</code></li><li><strong>默认值</strong>: <code>true</code></li><li><strong>命令行终端:</strong> <code>--diff.expand=false</code></li></ul><p>Expand all common lines.</p><h4 id="diff-truncatethreshold" tabindex="-1">diff.truncateThreshold <a class="header-anchor" href="#diff-truncatethreshold" aria-label="Permalink to “diff.truncateThreshold”">​</a></h4><ul><li><strong>类型</strong>: <code>number</code></li><li><strong>默认值</strong>: <code>0</code></li><li><strong>命令行终端:</strong> <code>--diff.truncateThreshold=&lt;path&gt;</code></li></ul><p>要显示的差异结果的最大长度。超过此阈值的差异将被截断。 默认值为 0 时，截断不会生效。</p><h4 id="diff-truncateannotation" tabindex="-1">diff.truncateAnnotation <a class="header-anchor" href="#diff-truncateannotation" aria-label="Permalink to “diff.truncateAnnotation”">​</a></h4><ul><li><strong>类型</strong>: <code>string</code></li><li><strong>默认值</strong>: <code>&#39;... Diff result is truncated&#39;</code></li><li><strong>命令行终端:</strong> <code>--diff.truncateAnnotation=&lt;annotation&gt;</code></li></ul><p>在 diff 结果末尾输出的注释（如果被截断）。</p><h4 id="diff-truncateannotationcolor" tabindex="-1">diff.truncateAnnotationColor <a class="header-anchor" href="#diff-truncateannotationcolor" aria-label="Permalink to “diff.truncateAnnotationColor”">​</a></h4><ul><li><strong>类型</strong>: <code>DiffOptionsColor = (arg: string) =&gt; string</code></li><li><strong>默认值</strong>: <code>noColor = (string: string): string =&gt; string</code></li></ul><p>截断注释的颜色，默认为无色输出。</p><h4 id="diff-printbasicprototype" tabindex="-1">diff.printBasicPrototype <a class="header-anchor" href="#diff-printbasicprototype" aria-label="Permalink to “diff.printBasicPrototype”">​</a></h4><ul><li><strong>Type</strong>: <code>boolean</code></li><li><strong>Default</strong>: <code>false</code></li></ul><p>Print basic prototype <code>Object</code> and <code>Array</code> in diff output</p><h4 id="diff-maxdepth" tabindex="-1">diff.maxDepth <a class="header-anchor" href="#diff-maxdepth" aria-label="Permalink to “diff.maxDepth”">​</a></h4><ul><li><strong>Type</strong>: <code>number</code></li><li><strong>Default</strong>: <code>20</code> (or <code>8</code> when comparing different types)</li></ul><p>Limit the depth to recurse when printing nested objects</p><h3 id="faketimers" tabindex="-1">fakeTimers <a class="header-anchor" href="#faketimers" aria-label="Permalink to “fakeTimers”">​</a></h3><ul><li><strong>类型:</strong> <code>FakeTimerInstallOpts</code></li></ul><p>当使用 <a href="/api/vi.html#vi-usefaketimers"><code>vi.useFakeTimers()</code></a>时，Vitest 将向 <a href="https://www.npmjs.com/package/@sinonjs/fake-timers" target="_blank" rel="noreferrer"><code>@sinon/fake-timers</code></a> 传递的选项。</p><h4 id="faketimers-now" tabindex="-1">fakeTimers.now <a class="header-anchor" href="#faketimers-now" aria-label="Permalink to “fakeTimers.now”">​</a></h4><ul><li><strong>类型:</strong> <code>number | Date</code></li><li><strong>默认值:</strong> <code>Date.now()</code></li></ul><p>用指定的 unix 时间安装假计时器。</p><h4 id="faketimers-tofake" tabindex="-1">fakeTimers.toFake <a class="header-anchor" href="#faketimers-tofake" aria-label="Permalink to “fakeTimers.toFake”">​</a></h4><ul><li><strong>类型:</strong> <code>(&#39;setTimeout&#39; | &#39;clearTimeout&#39; | &#39;setImmediate&#39; | &#39;clearImmediate&#39; | &#39;setInterval&#39; | &#39;clearInterval&#39; | &#39;Date&#39; | &#39;nextTick&#39; | &#39;hrtime&#39; | &#39;requestAnimationFrame&#39; | &#39;cancelAnimationFrame&#39; | &#39;requestIdleCallback&#39; | &#39;cancelIdleCallback&#39; | &#39;performance&#39; | &#39;queueMicrotask&#39;)[]</code></li><li><strong>默认值:</strong> 除 <code>nextTick</code> 和 <code>queueMicrotask</code> 外的所有全局可用方法</li></ul><p>包含要伪造的全局方法和 API 名称的数组。</p><p>要只模拟 <code>setTimeout()</code> 和 <code>nextTick()</code> ，请将此属性指定为 <code>[&#39;setTimeout&#39;,&#39;nextTick&#39;]</code>。</p><p>使用 <code>--pool=forks</code> 在 <code>node:child_process</code> 内运行 Vitest 时，不支持模拟 <code>nextTick</code>。NodeJS 在 <code>node:child_process</code> 中内部使用了 <code>process.nextTick</code>，当模拟它时会挂起。使用 <code>--pool=threads</code> 运行 Vitest 时支持模拟 <code>nextTick</code>。</p><h4 id="faketimers-looplimit" tabindex="-1">fakeTimers.loopLimit <a class="header-anchor" href="#faketimers-looplimit" aria-label="Permalink to “fakeTimers.loopLimit”">​</a></h4><ul><li><strong>类型:</strong> <code>number</code></li><li><strong>默认值:</strong> <code>10_000</code></li></ul><p>调用 <a href="/api/vi.html#vi-runalltimers"><code>vi.runAllTimers()</code></a> 时将运行的计时器的最大数量。</p><h4 id="faketimers-shouldadvancetime" tabindex="-1">fakeTimers.shouldAdvanceTime <a class="header-anchor" href="#faketimers-shouldadvancetime" aria-label="Permalink to “fakeTimers.shouldAdvanceTime”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li></ul><p>告诉 @sinonjs/fake-timers 根据实际系统时间的变化自动递增模拟时间（例如，实际系统时间每变化 20 毫秒，模拟时间就递增 20 毫秒）。</p><h4 id="faketimers-advancetimedelta" tabindex="-1">fakeTimers.advanceTimeDelta <a class="header-anchor" href="#faketimers-advancetimedelta" aria-label="Permalink to “fakeTimers.advanceTimeDelta”">​</a></h4><ul><li><strong>类型:</strong> <code>number</code></li><li><strong>默认值:</strong> <code>20</code></li></ul><p>只有在和 <code>shouldAdvanceTime: true</code> 一起使用时才相关。实际系统时间每发生一次 advanceTimeDelta ms 变化，模拟时间就增加一次 advanceTimeDelta ms。</p><h4 id="faketimers-shouldclearnativetimers" tabindex="-1">fakeTimers.shouldClearNativeTimers <a class="header-anchor" href="#faketimers-shouldclearnativetimers" aria-label="Permalink to “fakeTimers.shouldClearNativeTimers”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>true</code></li></ul><p>通过委托各自的处理程序，告诉假冒计时器清除 &quot;native&quot;（即非假冒）计时器。禁用时，如果计时器在启动假计时器会话之前已经存在，则可能导致意外行为。</p>`,52)),i("h3",Cs,[s[189]||(s[189]=e("projects",-1)),a(n),s[190]||(s[190]=e()),s[191]||(s[191]=i("a",{class:"header-anchor",href:"#projects","aria-label":"Permalink to “projects”"},"​",-1))]),s[265]||(s[265]=l(`<ul><li><strong>类型:</strong> <code>TestProjectConfiguration[]</code></li><li><strong>默认值:</strong> <code>[]</code></li></ul><p>一个由多个 <a href="/guide/projects.html">项目</a> 组成的数组。</p><h3 id="isolate" tabindex="-1">isolate <a class="header-anchor" href="#isolate" aria-label="Permalink to “isolate”">​</a></h3><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>true</code></li><li><strong>命令行终端:</strong> <code>--no-isolate</code>, <code>--isolate=false</code></li></ul><p>在隔离的环境中运行测试。此选项对 <code>vmThreads</code> 和 <code>vmForks</code> 池没有影响。</p><p>如果你的代码不依赖于副作用（对于具有 <code>node</code> 环境的项目通常如此），禁用此选项可能会<a href="/guide/improving-performance.html">改进性能</a>。</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>你可以使用 <a href="#pooloptions"><code>poolOptions</code></a> 属性禁用特定池的隔离。</p></div><h3 id="includeTaskLocation" tabindex="-1">includeTaskLocation <a class="header-anchor" href="#includeTaskLocation" aria-label="Permalink to “includeTaskLocation”">​</a></h3><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li></ul><p>Vitest API 在 <a href="#reporters">reporters</a> 中接收任务时是否应包含<code>location</code>属性。如果我们有大量测试，这可能会导致性能小幅下降。</p><p><code>location</code> 属性的 <code>列</code> 和 <code>行</code> 值与原始文件中的 <code>test</code> 或 <code>describe</code> 位置相对应。</p><p>如果我们没有明确禁用该选项，并且在运行 Vitest 时使用了该选项，则该选项将自动启用：</p><ul><li><a href="/guide/ui.html">Vitest UI</a></li><li>或使用不带 <a href="/guide/browser/#headless">headless</a> 模式的 <a href="/guide/browser/">浏览器模式</a></li><li>或使用<a href="/guide/reporters.html#html-reporter">HTML 报告器</a></li></ul><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>如果不使用依赖于该选项的自定义代码，该选项将不起作用。</p></div><h3 id="snapshotEnvironment" tabindex="-1">snapshotEnvironment <a class="header-anchor" href="#snapshotEnvironment" aria-label="Permalink to “snapshotEnvironment”">​</a></h3><ul><li><strong>类型:</strong> <code>string</code></li></ul><p>自定义快照环境实现的路径。如果在不支持 Node.js API 的环境中运行测试，该选项将非常有用。此选项对浏览器运行程序没有任何影响。</p><p>该对象应具有 <code>SnapshotEnvironment</code> 的形状，用于解析和读/写快照文件：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> interface</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SnapshotEnvironment</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getVersion</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  getHeader</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  resolvePath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">filepath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  resolveRawPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">testPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">rawPath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  saveSnapshotFile</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">filepath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">snapshot</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  readSnapshotFile</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">filepath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">string</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  removeSnapshotFile</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">filepath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Promise</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">void</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>如果只需覆盖部分 API，可从 <code>vitest/snapshot</code> 入口扩展默认的 <code>VitestSnapshotEnvironment</code> 。</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>这是一个低级选项，仅适用于无法访问默认 Node.js API 的高级情况。</p><p>如果只需要配置快照功能，请使用 <a href="#snapshotformat"><code>snapshotFormat</code></a>或 <a href="#resolvesnapshotpath"><code>resolveSnapshotPath</code></a>选项。</p></div><h3 id="env" tabindex="-1">env <a class="header-anchor" href="#env" aria-label="Permalink to “env”">​</a></h3><ul><li><strong>类型:</strong> <code>Partial&lt;NodeJS.ProcessEnv&gt;</code></li></ul><p>测试期间在 <code>process.env</code> 和 <code>import.meta.env</code> 中可用的环境变量。这些变量在主进程中不可用（例如在 <code>globalSetup</code> 中）。</p><h3 id="expect" tabindex="-1">expect <a class="header-anchor" href="#expect" aria-label="Permalink to “expect”">​</a></h3><ul><li><strong>类型:</strong> <code>ExpectOptions</code></li></ul><h4 id="expect-requireassertions" tabindex="-1">expect.requireAssertions <a class="header-anchor" href="#expect-requireassertions" aria-label="Permalink to “expect.requireAssertions”">​</a></h4><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li></ul><p>与每次测试开始时调用 <a href="/api/expect.html#expect-hasassertions"><code>expect.hasAssertions()</code></a> 相同。这可确保不会意外通过任何测试。</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>这仅适用于 Vitest 的<code>expect</code>。如果我们使用<code>assert</code>或<code>.should</code>断言，它们将不计算在内，并且我们的测试将因缺少 expect 断言而失败。</p><p>我们可以通过调用 <code>vi.setConfig({ expect: { requireAssertions: false } })</code> 来更改此值。该配置将应用于每个后续 <code>expect</code> 调用，直到手动调用 <code>vi.resetConfig</code>。</p></div><h4 id="expect-poll" tabindex="-1">expect.poll <a class="header-anchor" href="#expect-poll" aria-label="Permalink to “expect.poll”">​</a></h4><p><a href="/api/expect.html#poll"><code>expect.poll</code></a> 的全局配置选项。这些选项与我们可以传递给 <code>expect.poll(condition, options)</code> 的选项相同。</p><h5 id="expect-poll-interval" tabindex="-1">expect.poll.interval <a class="header-anchor" href="#expect-poll-interval" aria-label="Permalink to “expect.poll.interval”">​</a></h5><ul><li><strong>类型:</strong> <code>number</code></li><li><strong>默认值:</strong> <code>50</code></li></ul><p>轮询间隔（以毫秒为单位）</p><h5 id="expect-poll-timeout" tabindex="-1">expect.poll.timeout <a class="header-anchor" href="#expect-poll-timeout" aria-label="Permalink to “expect.poll.timeout”">​</a></h5><ul><li><strong>类型:</strong> <code>number</code></li><li><strong>默认值:</strong> <code>1000</code></li></ul><p>轮询超时时间（以毫秒为单位）</p><h3 id="printconsoletrace" tabindex="-1">printConsoleTrace <a class="header-anchor" href="#printconsoletrace" aria-label="Permalink to “printConsoleTrace”">​</a></h3><ul><li><strong>类型:</strong> <code>boolean</code></li><li><strong>默认值:</strong> <code>false</code></li></ul><p>每次调用 <code>console</code> 方法时都输出堆栈追踪信息，这对于排查问题非常有帮助。</p>`,41)),i("h3",As,[s[193]||(s[193]=e("attachmentsDir ",-1)),a(o,null,{default:t(()=>s[192]||(s[192]=[e("3.2.0",-1)])),_:1,__:[192]}),s[194]||(s[194]=e()),s[195]||(s[195]=i("a",{class:"header-anchor",href:"#attachmentsdir-3-2-0","aria-label":"Permalink to “attachmentsDir 3.2.0”"},"​",-1))]),s[266]||(s[266]=i("ul",null,[i("li",null,[i("strong",null,"类型:"),e(),i("code",null,"string")]),i("li",null,[i("strong",null,"默认值:"),e(),i("code",null,"'.vitest-attachments'")])],-1)),s[267]||(s[267]=i("p",null,[e("相对于项目根目录，用于保存通过 "),i("a",{href:"/guide/test-context.html#annotate"},[i("code",null,"context.annotate")]),e(" 方法生成的附件文件的目录路径。")],-1))])}const ws=d(E,[["render",xs]]);export{js as __pageData,ws as default};
