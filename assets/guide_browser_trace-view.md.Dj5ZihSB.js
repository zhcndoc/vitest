import{_ as i,o as a,i as e,R as t}from"./chunks/framework.XDTXXE-5.js";const o=JSON.parse('{"title":"追踪视图","description":"","frontmatter":{},"headers":[],"relativePath":"guide/browser/trace-view.md","filePath":"guide/browser/trace-view.md","lastUpdated":1771601921000}'),n={name:"guide/browser/trace-view.md"};function l(p,s,h,r,k,d){return a(),e("div",null,[...s[0]||(s[0]=[t(`<h1 id="trace-view" tabindex="-1">追踪视图 <a class="header-anchor" href="#trace-view" aria-label="Permalink to “追踪视图”">​</a></h1><p>Vitest 浏览器模式支持生成 Playwright 的 <a href="https://playwright.dev/docs/trace-viewer#viewing-remote-traces" target="_blank" rel="noreferrer">追踪文件</a>。要启用追踪功能，需要在 <code>test.browser</code> 配置中设置 <a href="/config/browser/trace.html"><code>trace</code></a> 选项。</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>生成追踪文件仅在使用 <a href="/config/browser/playwright.html">Playwright provider</a> 时可用。</p></div><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-11" id="tab-12" checked><label data-title="vitest.config.js" for="tab-12">vitest.config.js</label><input type="radio" name="group-11" id="tab-13"><label data-title="CLI" for="tab-13">CLI</label></div><div class="blocks"><div class="language-ts active"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { playwright } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@vitest/browser-playwright&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    browser: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      provider: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">playwright</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      trace: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;on&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vitest</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --browser.trace=on</span></span></code></pre></div></div></div><p>默认情况下，Vitest 会为每个测试生成一个追踪文件。你也可以通过设置 <code>trace</code> 为 <code>&#39;on-first-retry&#39;</code>、<code>&#39;on-all-retries&#39;</code> 或 <code>&#39;retain-on-failure&#39;</code> 来配置仅在测试失败时生成追踪。这些文件将保存在测试文件相邻的 <code>__traces__</code> 文件夹中。追踪文件的名称包括项目名称、测试名称、the <a href="/api/test.html#repeats"><code>repeats</code></a> 次数和 <a href="/api/test.html#retry"><code>retry</code></a> 次数：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>chromium-my-test-0-0.trace.zip</span></span>
<span class="line"><span>^^^^^^^^ 项目名称</span></span>
<span class="line"><span>         ^^^^^^ 测试名称</span></span>
<span class="line"><span>                ^ 重复次数</span></span>
<span class="line"><span>                  ^ 重试次数</span></span></code></pre></div><p>要更改输出目录，可以在 <code>test.browser.trace</code> 配置中设置 <code>tracesDir</code> 选项。这样所有追踪文件将按测试文件分组存储在同一目录中。</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="vitest.config.js">vitest.config.js</span></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { playwright } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@vitest/browser-playwright&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    browser: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      provider: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">playwright</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      trace: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        mode: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;on&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 路径相对于项目根目录</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tracesDir: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./playwright-traces&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></div><p>追踪文件在报告器中作为 <a href="/guide/test-annotations.html">注释</a> 形式呈现。例如，在 HTML 报告器中，你可以在测试详情页中找到追踪文件的链接。</p><h2 id="preview" tabindex="-1">预览 <a class="header-anchor" href="#preview" aria-label="Permalink to “预览”">​</a></h2><p>要打开追踪文件，可以使用 Playwright Trace Viewer。在终端中运行以下命令：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">npx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> playwright</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> show-trace</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;path-to-trace-file&quot;</span></span></code></pre></div><p>这将启动 Trace Viewer 并加载指定的追踪文件。</p><p>或者，你可以在浏览器中打开 <a href="https://trace.playwright.dev" target="_blank" rel="noreferrer">https://trace.playwright.dev</a> 并在那里上传追踪文件。</p><h2 id="limitations" tabindex="-1">局限性 <a class="header-anchor" href="#limitations" aria-label="Permalink to “局限性”">​</a></h2><p>目前，Vitest 无法填充 Trace Viewer 中的 &quot;Sources&quot; 标签页。这意味着虽然你可以看到测试期间捕获的操作和截图，但无法直接在 Trace Viewer 中查看测试的源代码。你需要返回代码编辑器查看测试实现。</p>`,16)])])}const g=i(n,[["render",l]]);export{o as __pageData,g as default};
