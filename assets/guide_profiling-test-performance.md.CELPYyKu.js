import{_ as i,o as a,i as e,R as n,aX as t}from"./chunks/framework.XDTXXE-5.js";const F=JSON.parse('{"title":"性能测试分析","description":"","frontmatter":{},"headers":[],"relativePath":"guide/profiling-test-performance.md","filePath":"guide/profiling-test-performance.md","lastUpdated":1771601921000}'),l={name:"guide/profiling-test-performance.md"};function p(h,s,r,k,d,o){return a(),e("div",null,[...s[0]||(s[0]=[n(`<h1 id="profiling-test-performance" tabindex="-1">性能测试分析 <a class="header-anchor" href="#profiling-test-performance" aria-label="Permalink to “性能测试分析”">​</a></h1><p>当你运行 Vitest 时，会显示你的多个时间指标：</p><blockquote><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  v2.1.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /x/vitest/examples/profiling</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">✓</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test/prime-number.test.ts</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (1) 4517ms</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ✓</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> generate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> prime</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> number</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 4517ms</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Test</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Files</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> passed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (1)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">     Tests</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> passed</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (1)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> at</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  09:32:53</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  Duration</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  4.80s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (transform </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">44ms,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> setup</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0ms,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 35ms,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tests</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 4.52s,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> environment</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 0ms</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Time metrics ^^</span></span></code></pre></div></blockquote><ul><li>Transform：转换文件所用的时间。详情请参阅 <a href="#file-transform">文件转换</a>。</li><li>Setup：执行 <a href="/config/setupfiles.html"><code>setupFiles</code></a> 文件所花费的时间。</li><li>Import：导入测试文件及其依赖项所花费的时间。这也包括收集所有测试所花费的时间。注意，这不包括测试内部的动态导入。</li><li>Tests：实际执行测试用例所用的时间。</li><li>Environment：<a href="/config/environment.html"><code>配置测试</code></a> 环境（比如 JSDOM）所需的时间。</li></ul><h2 id="test-runner" tabindex="-1">测试运行器 <a class="header-anchor" href="#test-runner" aria-label="Permalink to “测试运行器”">​</a></h2><p>当测试执行时间较长的时候，可以生成测试运行器的性能分析报告。可以参考 NodeJS 文档来了解和使用这些选项：</p><ul><li><a href="https://nodejs.org/api/cli.html#--cpu-prof" target="_blank" rel="noreferrer"><code>--cpu-prof</code></a></li><li><a href="https://nodejs.org/api/cli.html#--heap-prof" target="_blank" rel="noreferrer"><code>--heap-prof</code></a></li><li><a href="https://nodejs.org/api/cli.html#--prof" target="_blank" rel="noreferrer"><code>--prof</code></a></li></ul><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>由于 <code>node:worker_threads</code> 的限制， <code>--prof</code> 不能与 <code>pool: &#39;threads&#39;</code> 一起使用。</p></div><p>要将这些选项传递给 Vitest 的测试运行器，请在 Vitest 配置中定义 <code>execArgv</code>：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    fileParallelism: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    execArgv: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;--cpu-prof&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;--cpu-prof-dir=test-runner-profile&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;--heap-prof&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;--heap-prof-dir=test-runner-profile&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>测试运行后，应该会生成 <code>test-runner-profile/*.cpuprofile</code> 和 <code>test-runner-profile/*.heapprofile</code> 文件。想要知道如何分析这些文件，可以仔细查看 <a href="#inspecting-profiling-records">性能分析记录</a>。</p><p>也可以看看 <a href="https://github.com/vitest-dev/vitest/tree/main/examples/profiling" target="_blank" rel="noreferrer">性能分析 | 示例</a> 。</p><h2 id="main-thread" tabindex="-1">主线程 <a class="header-anchor" href="#main-thread" aria-label="Permalink to “主线程”">​</a></h2><p>对主线程进行性能分析有助于调试 Vitest 的 Vite 使用情况和 <a href="/config/globalsetup.html"><code>globalSetup</code></a> 文件。 这也是 Vite 插件运行的地方。</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>可以查看 <a href="https://cn.vitejs.dev/guide/performance" target="_blank" rel="noreferrer">性能 | Vite</a> 以获取更多关于 Vite 特定性能分析的提示。</p><p>我们推荐使用 <a href="https://github.com/antfu-collective/vite-plugin-inspect" target="_blank" rel="noreferrer"><code>vite-plugin-inspect</code></a> 来分析你的 Vite 插件性能。</p></div><p>要执行此操作，需要向运行 Vitest 的 Node 进程传递参数。</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">node</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cpu-prof</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cpu-prof-dir=main-profile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./node_modules/vitest/vitest.mjs</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --run</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^                                  ^^^^^</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#               NodeJS arguments                                           Vitest arguments</span></span></code></pre></div><p>测试运行后会生成一个 <code>main-profile/*.cpuprofile</code> 文件。有关如何分析这些文件的说明，可以查看<a href="#inspecting-profiling-records">检查分析记录</a>。</p><h2 id="file-transform" tabindex="-1">文件转换 <a class="header-anchor" href="#file-transform" aria-label="Permalink to “文件转换”">​</a></h2><p>This profiling strategy is a good way to identify unnecessary transforms caused by <a href="https://vitejs.dev/guide/performance.html#avoid-barrel-files" target="_blank" rel="noreferrer">barrel files</a>. If these logs contain files that should not be loaded when your test is run, you might have barrel files that are importing files unnecessarily.</p><p>也可以使用 <a href="/guide/ui.html">Vitest UI</a> 来调试由打包文件引起的缓慢问题。 下面的例子展示了不使用打包文件导入文件可以减少约85%的转换文件数量。</p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-104" id="tab-105" checked><label data-title="File tree" for="tab-105">File tree</label><input type="radio" name="group-104" id="tab-106"><label data-title="example.test.ts" for="tab-106">example.test.ts</label></div><div class="blocks"><div class="language- active"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>├── src</span></span>
<span class="line"><span>│   └── utils</span></span>
<span class="line"><span>│       ├── currency.ts</span></span>
<span class="line"><span>│       ├── formatters.ts  &lt;-- File to test</span></span>
<span class="line"><span>│       ├── index.ts</span></span>
<span class="line"><span>│       ├── location.ts</span></span>
<span class="line"><span>│       ├── math.ts</span></span>
<span class="line"><span>│       ├── time.ts</span></span>
<span class="line"><span>│       └── users.ts</span></span>
<span class="line"><span>├── test</span></span>
<span class="line"><span>│   └── formatters.test.ts</span></span>
<span class="line"><span>└── vitest.config.ts</span></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark has-diff" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { expect, test } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest&#39;</span></span>
<span class="line diff remove"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { formatter } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../src/utils&#39;</span></span>
<span class="line diff add"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { formatter } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../src/utils/formatters&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;formatter works&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  expect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(formatter).not.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toThrow</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></div></div><img src="`+t+`" alt="Vitest UI demonstrating barrel file issues"><p>To see how files are transformed, you can use <code>VITEST_DEBUG_DUMP</code> environment variable to write transformed files in the file system:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">VITEST_DEBUG_DUMP=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vitest</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --run</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  v2.1.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /x/vitest/examples/profiling</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ls</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> .vitest-dump/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_x_examples_profiling_global-setup_ts-1292904907.js</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_x_examples_profiling_test_prime-number_test_ts-1413378098.js</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">_src_prime-number_ts-525172412.js</span></span></code></pre></div><h2 id="code-coverage" tabindex="-1">代码覆盖率 <a class="header-anchor" href="#code-coverage" aria-label="Permalink to “代码覆盖率”">​</a></h2><p>如果你的项目中代码覆盖率生成较慢，您可以使用 <code>DEBUG=vitest:coverage</code> 环境变量来启用性能日志记录。</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark has-highlighted" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">DEBUG=vitest:coverage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vitest</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --coverage</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  v3.1.1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /x/vitest-example</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vitest:coverage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Reading</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> coverage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> results</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2/2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vitest:coverage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Converting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1/2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vitest:coverage</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /x/src/multiply.ts</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vitest:coverage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Converting</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2/2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vitest:coverage</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 552</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /x/src/add.ts</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vitest:coverage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Uncovered</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> files</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 1/2</span></span>
<span class="line highlighted error"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vitest:coverage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> File</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/x/src/large-file.ts&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> taking</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> longer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> than</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 3s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vitest:coverage</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3027</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /x/src/large-file.ts</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vitest:coverage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Uncovered</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> files</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2/2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vitest:coverage</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ms</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /x/src/untested-file.ts</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  vitest:coverage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Generate</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> coverage</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> total</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> time</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3521</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ms</span></span></code></pre></div><p>这种性能分析方法非常适合检测被覆盖率提供程序意外包含的大文件。 例如，如果你的配置意外地将大型构建压缩后的 JavaScript 文件包含在代码覆盖率中，这些文件应该会出现在日志中。 在这种情况下，你可能需要调整 <a href="/config/coverage.html#coverage-include"><code>coverage.include</code></a> 和 <a href="/config/coverage.html#coverage-exclude"><code>coverage.exclude</code></a> 选项。</p><h2 id="inspecting-profiling-records" tabindex="-1">性能记录分析 <a class="header-anchor" href="#inspecting-profiling-records" aria-label="Permalink to “性能记录分析”">​</a></h2><p>可以使用各种工具检查 <code>*.cpuprofile</code> 和 <code>*.heapprofile</code> 的内容。下面是一些示例。</p><ul><li><a href="https://www.speedscope.app/" target="_blank" rel="noreferrer">Speedscope</a></li><li><a href="https://code.visualstudio.com/docs/nodejs/profiling#_analyzing-a-profile" target="_blank" rel="noreferrer">在 Visual Studio Code 中对 JavaScript 进行性能分析</a></li><li><a href="https://developer.chrome.com/docs/devtools/performance/nodejs#analyze" target="_blank" rel="noreferrer">使用性能面板分析 Node.js 性能 | developer.chrome.com</a></li><li><a href="https://developer.chrome.com/docs/devtools/memory-problems/heap-snapshots#view_snapshots" target="_blank" rel="noreferrer">内存面板概览 | developer.chrome.com</a></li></ul>`,32)])])}const c=i(l,[["render",p]]);export{F as __pageData,c as default};
