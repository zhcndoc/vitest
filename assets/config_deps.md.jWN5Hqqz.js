import{_ as s,o as i,i as o,R as t}from"./chunks/framework.XDTXXE-5.js";const u=JSON.parse('{"title":"deps | Config","description":"","frontmatter":{"title":"deps | Config","outline":"deep"},"headers":[],"relativePath":"config/deps.md","filePath":"config/deps.md","lastUpdated":1771601921000}'),a={name:"config/deps.md"};function n(d,e,l,r,p,c){return i(),o("div",null,[...e[0]||(e[0]=[t(`<h1 id="deps" tabindex="-1">deps <a class="header-anchor" href="#deps" aria-label="Permalink to “deps”">​</a></h1><ul><li><strong>Type:</strong> <code>{ optimizer?, ... }</code></li></ul><p>Handling for dependencies resolution.</p><h2 id="deps-optimizer" tabindex="-1">deps.optimizer <a class="header-anchor" href="#deps-optimizer" aria-label="Permalink to “deps.optimizer”">​</a></h2><ul><li><strong>Type:</strong> <code>{ ssr?, client? }</code></li><li><strong>See also:</strong> <a href="https://vitejs.dev/config/dep-optimization-options.html" target="_blank" rel="noreferrer">Dep Optimization Options</a></li></ul><p>Enable dependency optimization. If you have a lot of tests, this might improve their performance.</p><p>When Vitest encounters the external library listed in <code>include</code>, it will be bundled into a single file using esbuild and imported as a whole module. This is good for several reasons:</p><ul><li>Importing packages with a lot of imports is expensive. By bundling them into one file we can save a lot of time</li><li>Importing UI libraries is expensive because they are not meant to run inside Node.js</li><li>Your <code>alias</code> configuration is now respected inside bundled packages</li><li>Code in your tests is running closer to how it&#39;s running in the browser</li></ul><p>Be aware that only packages in <code>deps.optimizer?.[mode].include</code> option are bundled (some plugins populate this automatically, like Svelte). You can read more about available options in <a href="https://vitejs.dev/config/dep-optimization-options.html" target="_blank" rel="noreferrer">Vite</a> docs (Vitest doesn&#39;t support <code>disable</code> and <code>noDiscovery</code> options). By default, Vitest uses <code>optimizer.client</code> for <code>jsdom</code> and <code>happy-dom</code> environments, and <code>optimizer.ssr</code> for <code>node</code> and <code>edge</code> environments.</p><p>This options also inherits your <code>optimizeDeps</code> configuration (for web Vitest will extend <code>optimizeDeps</code>, for ssr - <code>ssr.optimizeDeps</code>). If you redefine <code>include</code>/<code>exclude</code> option in <code>deps.optimizer</code> it will extend your <code>optimizeDeps</code> when running tests. Vitest automatically removes the same options from <code>include</code>, if they are listed in <code>exclude</code>.</p><div class="tip custom-block"><p class="custom-block-title custom-block-title-default">TIP</p><p>You will not be able to edit your <code>node_modules</code> code for debugging, since the code is actually located in your <code>cacheDir</code> or <code>test.cache.dir</code> directory. If you want to debug with <code>console.log</code> statements, edit it directly or force rebundling with <code>deps.optimizer?.[mode].force</code> option.</p></div><h3 id="deps-optimizer-mode-enabled" tabindex="-1">deps.optimizer.{mode}.enabled <a class="header-anchor" href="#deps-optimizer-mode-enabled" aria-label="Permalink to “deps.optimizer.{mode}.enabled”">​</a></h3><ul><li><strong>Type:</strong> <code>boolean</code></li><li><strong>Default:</strong> <code>false</code></li></ul><p>Enable dependency optimization.</p><h2 id="deps-client" tabindex="-1">deps.client <a class="header-anchor" href="#deps-client" aria-label="Permalink to “deps.client”">​</a></h2><ul><li><strong>Type:</strong> <code>{ transformAssets?, ... }</code></li></ul><p>Options that are applied to external files when the environment is set to <code>client</code>. By default, <code>jsdom</code> and <code>happy-dom</code> use <code>client</code> environment, while <code>node</code> and <code>edge</code> environments use <code>ssr</code>, so these options will have no affect on files inside those environments.</p><p>Usually, files inside <code>node_modules</code> are externalized, but these options also affect files in <a href="#server-deps-external"><code>server.deps.external</code></a>.</p><h3 id="deps-client-transformassets" tabindex="-1">deps.client.transformAssets <a class="header-anchor" href="#deps-client-transformassets" aria-label="Permalink to “deps.client.transformAssets”">​</a></h3><ul><li><strong>Type:</strong> <code>boolean</code></li><li><strong>Default:</strong> <code>true</code></li></ul><p>Should Vitest process assets (.png, .svg, .jpg, etc) files and resolve them like Vite does in the browser.</p><p>This module will have a default export equal to the path to the asset, if no query is specified.</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>At the moment, this option only works with <a href="#vmthreads"><code>vmThreads</code></a> and <a href="#vmforks"><code>vmForks</code></a> pools.</p></div><h3 id="deps-client-transformcss" tabindex="-1">deps.client.transformCss <a class="header-anchor" href="#deps-client-transformcss" aria-label="Permalink to “deps.client.transformCss”">​</a></h3><ul><li><strong>Type:</strong> <code>boolean</code></li><li><strong>Default:</strong> <code>true</code></li></ul><p>Should Vitest process CSS (.css, .scss, .sass, etc) files and resolve them like Vite does in the browser.</p><p>If CSS files are disabled with <a href="#css"><code>css</code></a> options, this option will just silence <code>ERR_UNKNOWN_FILE_EXTENSION</code> errors.</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>At the moment, this option only works with <a href="#vmthreads"><code>vmThreads</code></a> and <a href="#vmforks"><code>vmForks</code></a> pools.</p></div><h3 id="deps-client-transformglobpattern" tabindex="-1">deps.client.transformGlobPattern <a class="header-anchor" href="#deps-client-transformglobpattern" aria-label="Permalink to “deps.client.transformGlobPattern”">​</a></h3><ul><li><strong>Type:</strong> <code>RegExp | RegExp[]</code></li><li><strong>Default:</strong> <code>[]</code></li></ul><p>Regexp pattern to match external files that should be transformed.</p><p>By default, files inside <code>node_modules</code> are externalized and not transformed, unless it&#39;s CSS or an asset, and corresponding option is not disabled.</p><div class="warning custom-block"><p class="custom-block-title custom-block-title-default">WARNING</p><p>At the moment, this option only works with <a href="#vmthreads"><code>vmThreads</code></a> and <a href="#vmforks"><code>vmForks</code></a> pools.</p></div><h2 id="deps-interopdefault" tabindex="-1">deps.interopDefault <a class="header-anchor" href="#deps-interopdefault" aria-label="Permalink to “deps.interopDefault”">​</a></h2><ul><li><strong>Type:</strong> <code>boolean</code></li><li><strong>Default:</strong> <code>true</code></li></ul><p>Interpret CJS module&#39;s default as named exports. Some dependencies only bundle CJS modules and don&#39;t use named exports that Node.js can statically analyze when a package is imported using <code>import</code> syntax instead of <code>require</code>. When importing such dependencies in Node environment using named exports, you will see this error:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>import { read } from &#39;fs-jetpack&#39;;</span></span>
<span class="line"><span>         ^^^^</span></span>
<span class="line"><span>SyntaxError: Named export &#39;read&#39; not found. The requested module &#39;fs-jetpack&#39; is a CommonJS module, which may not support all module.exports as named exports.</span></span>
<span class="line"><span>CommonJS modules can always be imported via the default export.</span></span></code></pre></div><p>Vitest doesn&#39;t do static analysis, and cannot fail before your running code, so you will most likely see this error when running tests, if this feature is disabled:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>TypeError: createAsyncThunk is not a function</span></span>
<span class="line"><span>TypeError: default is not a function</span></span></code></pre></div><p>By default, Vitest assumes you are using a bundler to bypass this and will not fail, but you can disable this behaviour manually, if your code is not processed.</p><h2 id="deps-moduledirectories" tabindex="-1">deps.moduleDirectories <a class="header-anchor" href="#deps-moduledirectories" aria-label="Permalink to “deps.moduleDirectories”">​</a></h2><ul><li><strong>Type:</strong> <code>string[]</code></li><li><strong>Default</strong>: <code>[&#39;node_modules&#39;]</code></li></ul><p>A list of directories that should be treated as module directories. This config option affects the behavior of <a href="/api/vi.html#vi-mock"><code>vi.mock</code></a>: when no factory is provided and the path of what you are mocking matches one of the <code>moduleDirectories</code> values, Vitest will try to resolve the mock by looking for a <code>__mocks__</code> folder in the <a href="#root">root</a> of the project.</p><p>This option will also affect if a file should be treated as a module when externalizing dependencies. By default, Vitest imports external modules with native Node.js bypassing Vite transformation step.</p><p>Setting this option will <em>override</em> the default, if you wish to still search <code>node_modules</code> for packages include it along with any other options:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vitest/config&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  test: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    deps: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      moduleDirectories: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node_modules&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, path.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;../../packages&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div>`,46)])])}const m=s(a,[["render",n]]);export{u as __pageData,m as default};
